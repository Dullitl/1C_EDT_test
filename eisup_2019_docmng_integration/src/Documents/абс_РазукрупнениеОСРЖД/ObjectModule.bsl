
//////////////////////////////////////////////////////////////////////////////////
// Обработчики событий

Процедура ОбработкаЗаполнения(ДанныеЗаполнения, СтандартнаяОбработка)
	
	Если ТипЗнч(ДанныеЗаполнения)=Тип("ДокументСсылка.абс_РазукрупнениеОС") Тогда
		
		СтандартнаяОбработка = Ложь;
		ЗаполнитьПоДокументу_абс_РазукрупнениеОС(ДанныеЗаполнения);
		
	КонецЕсли;
	
КонецПроцедуры

Процедура ПередЗаписью(Отказ, РежимЗаписи, РежимПроведения)
	
	ДополнительныеСвойства.Вставить("ЭтоНовый", ЭтоНовый());
	
	Если Не ОбменДанными.Загрузка Тогда
		Возврат;
	КонецЕсли;
	
	Если ПустаяСтрока(Номер) Тогда
		УстановитьНовыйНомер(Организация.Префикс);
	КонецЕсли;
	
	Если Не ЗначениеЗаполнено(Ответственный) Тогда
		Ответственный = ПараметрыСеанса.ТекущийПользователь;
	КонецЕсли;
	
КонецПроцедуры

Процедура ОбработкаПроведения(Отказ, РежимПроведения)
	
	Если Не ЗначениеЗаполнено(ДокументОснование) Тогда 
		Возврат;
	КонецЕсли;	
	
	Если Не ДополнительныеСвойства.ЭтоНовый Тогда
		абс_ПроведениеДокументов.УдалитьДвиженияРегистратора(Ссылка);
	КонецЕсли;
	
	Движения.абс_МеждународныйОСРЖД.Записывать = Истина;
	Движения.абс_ОсновныеСредстваРЖД.Записывать = Истина;
	Движения.абс_СтоимостьОСРЖД.Записывать = Истина;
	
	МенеджерВременныхТаблиц = Новый МенеджерВременныхТаблиц;
	
	НачалоПериода = НачалоМесяца(Дата);
	КонецПериода = КонецМесяца(Дата);
	
	СтруктураЗапросов = Документы.абс_РазукрупнениеОСРЖД.ПолучитьСтруктуруЗапросовПроведения();
	
	ПустыеСубконто = ПолучитьПустыеСубконто();
	
	Запрос = Новый Запрос;
	Запрос.МенеджерВременныхТаблиц = МенеджерВременныхТаблиц;
	Запрос.УстановитьПараметр("Период", НачалоПериода);
	Запрос.УстановитьПараметр("ПустыеСубконто", ПустыеСубконто);
	
	ТекстыЗапросов = Новый СписокЗначений;
	ТекстыЗапросов.Добавить(СтруктураЗапросов.абс_МеждународныйУчетОСРЖД_ТекстЗапросаВидыСубконтоСчетов, "");
	ТекстыЗапросов.Добавить(СтруктураЗапросов.абс_МеждународныйУчетОСРЖД_ТекстЗапросаСоответствиеСчетовХозрасчетныйРЖД, "");
	
	Запрос.Текст = "";
	Для Каждого ЭлементСписка Из ТекстыЗапросов Цикл
		Запрос.Текст = Запрос.Текст+ЭлементСписка.Значение;
	КонецЦикла;
	
	Запрос.ВыполнитьПакет();
	
	Запрос = Новый Запрос;
	Запрос.МенеджерВременныхТаблиц = МенеджерВременныхТаблиц;
	Запрос.УстановитьПараметр("Ссылка", Ссылка);
	Запрос.УстановитьПараметр("Период", Дата);
	Запрос.УстановитьПараметр("МоментДокумента", МоментВремени());
	Запрос.УстановитьПараметр("МоментДокументаДляРН", Новый Граница(КонецДня(Дата), ВидГраницы.Включая));
	
	Запрос.УстановитьПараметр("Организация", Организация);
	
	ТекстыЗапросов = Новый СписокЗначений;
	
	Запрос.УстановитьПараметр("ОсновноеСредство", ОсновноеСредство);
	
	ТекстыЗапросов.Добавить(СтруктураЗапросов.абс_ВнеоборотныеАктивы_ТекстЗапроса_ОсновныеСредстваРЖДПоОдномуОС, "");
	ТекстыЗапросов.Добавить(СтруктураЗапросов.Разукрупнение_ТекстЗапросаШапкаДокумента, "");
	ТекстыЗапросов.Добавить(СтруктураЗапросов.Разукрупнение_ТекстЗапросаТабличнаяЧастьОсновныеСредства, "");
	ТекстыЗапросов.Добавить(СтруктураЗапросов.Разукрупнение_ТекстЗапросаСтоимостьСтарогоОсновногоСредства, "");
	ТекстыЗапросов.Добавить(СтруктураЗапросов.Разукрупнение_ТекстЗапросаРаспределениеСтоимости, "");
	ТекстыЗапросов.Добавить(СтруктураЗапросов.Разукрупнение_ТекстЗапросаНераспределеннаяСтоимость, "");
	ТекстыЗапросов.Добавить(СтруктураЗапросов.Разукрупнение_ТекстЗапросаСтоимостьНовыхОсновныхСредств, "");
	ТекстыЗапросов.Добавить(СтруктураЗапросов.Разукрупнение_ТекстЗапросаТаблица_абс_ОсновныеСредстваРЖД, "Таблица_абс_ОсновныеСредстваРЖД");
	ТекстыЗапросов.Добавить(СтруктураЗапросов.Разукрупнение_ТекстЗапросаТаблица_абс_СтоимостьОСРЖД, "Таблица_абс_СтоимостьОСРЖД");
	ТекстыЗапросов.Добавить(СтруктураЗапросов.Разукрупнение_ТекстЗапросаТаблица_абс_МеждународныйОСРЖД, "Таблица_абс_МеждународныйОСРЖД");
	ТекстыЗапросов.Добавить(СтруктураЗапросов.Разукрупнение_УдалениеВременныхТаблиц, "");
	
	
	Запрос.Текст = "";
	Для Каждого ТекстЗапроса Из ТекстыЗапросов Цикл
		Запрос.Текст = Запрос.Текст+ТекстЗапроса.Значение;
	КонецЦикла;
	
	Результат = Запрос.ВыполнитьПакет();
	
	ТаблицыДанных = Новый Структура;
	
	Для Каждого ТекстЗапроса Из ТекстыЗапросов Цикл
		
		ИмяТаблицы = ТекстЗапроса.Представление;
		
		Если Не ПустаяСтрока(ИмяТаблицы) Тогда
			Индекс = ТекстыЗапросов.Индекс(ТекстЗапроса);
			ТаблицыДанных.Вставить(ИмяТаблицы, Результат[Индекс].Выгрузить());
		КонецЕсли;
		
	КонецЦикла;
	
	Если ТаблицыДанных.Свойство("Таблица_абс_ОсновныеСредстваРЖД") Тогда
		
		ТаблицаРегистра = ТаблицыДанных.Таблица_абс_ОсновныеСредстваРЖД;
		Если ТаблицаРегистра.Количество()>0 Тогда
			
			НаборЗаписей = Движения.абс_ОсновныеСредстваРЖД;
			НаборЗаписей.Загрузить(ТаблицаРегистра);
			
		КонецЕсли;
		
	КонецЕсли;
	
	Если ТаблицыДанных.Свойство("Таблица_абс_СтоимостьОСРЖД") Тогда
		
		ТаблицаРегистра = ТаблицыДанных.Таблица_абс_СтоимостьОСРЖД;
		Если ТаблицаРегистра.Количество()>0 Тогда
			
			НаборЗаписей = Движения.абс_СтоимостьОСРЖД;
			НаборЗаписей.Загрузить(ТаблицаРегистра);
			
		КонецЕсли;
		
	КонецЕсли;
	
	Если ТаблицыДанных.Свойство("Таблица_абс_МеждународныйОСРЖД") Тогда
		
		ТаблицаРегистра = ТаблицыДанных.Таблица_абс_МеждународныйОСРЖД;
		Если ТаблицаРегистра.Количество()>0 Тогда
			
			НаборЗаписей = Движения.абс_МеждународныйОСРЖД;
			НаборЗаписей.Загрузить(ТаблицаРегистра);
			
		КонецЕсли;
		
	КонецЕсли;
		
	
	//абс_ПроведениеДокументов.ИнициализироватьДополнительныеСвойстваДляПроведения(Ссылка, ДополнительныеСвойства, РежимПроведения);
	//Документы.абс_РазукрупнениеОСРЖД.ИнициализироватьДанныеДокумента(Ссылка, ДополнительныеСвойства, Отказ);
	//
	//Если Отказ Тогда
	//	Возврат;
	//КонецЕсли;
	//
	//абс_ПроведениеДокументов.ПодготовитьНаборыЗаписейКРегистрацииДвижений(ЭтотОбъект, ДополнительныеСвойства.ЭтоНовый);
	//
	//абс_ВнеоборотныеАктивы.Отразить_абс_ОсновныеСредстваРЖД(ДополнительныеСвойства, Движения, Отказ);
	//абс_ВнеоборотныеАктивы.Отразить_абс_СтоимостьОСРЖД(ДополнительныеСвойства, Движения, Отказ);
	//абс_МеждународныйУчетОСРЖД.Отразить_абс_МеждународныйОСРЖД(ДополнительныеСвойства, Движения, Отказ);
	//
	//абс_ПроведениеДокументов.ЗаписатьНаборыЗаписей(ЭтотОбъект);	
		
КонецПроцедуры



//////////////////////////////////////////////////////////////////////////////////
// Процедуры заполнения по документам-основаниям

Процедура ЗаполнитьПоДокументу_абс_РазукрупнениеОС(ДанныеЗаполнения)
	
	//ДокОснование = ДанныеЗаполнения.ПолучитьОбъект();
	ДокОснование = ДанныеЗаполнения;
	ЗаполнитьШапкуИОчиститьТЧ(ДокОснование);
	ОсновноеСредство = ДокОснование.СтароеОсновноеСредство;
	Для Каждого СтрокаОС Из ДокОснование.ОС Цикл
		
		СтрокаТЧ = ОсновныеСредства.Добавить();
		СтрокаТЧ.ОсновноеСредство = СтрокаОС.ОсновноеСредство;
		
		СтрокаТЧ.МОЛ = СтрокаОС.МОЛРегл;
		СтрокаТЧ.Местонахождение = ДокОснование.ПодразделениеОрганизации;
		СтрокаТЧ.КоэффициентУскорения = СтрокаОС.КоэффициентУскоренияБУ;
		Если СтрокаТЧ.КоэффициентУскорения=0 Тогда
			СтрокаТЧ.КоэффициентУскорения = 1;
		КонецЕсли;
		
		СтрокаТЧ.НачислятьАмортизацию = СтрокаОС.НачислятьАмортизациюБУ;
		СтрокаТЧ.ДатаПринятияКУчету = СтрокаОС.ДатаПринятияКУчетуРегл;
		СтрокаТЧ.СчетСниженияСтоимости = ПланыСчетов.абс_МеждународныйОСРЖД.Служебный;
		
		Способ = СтрокаОС.СпособОтраженияРасходовПоАмортизацииБУ.Способы[0];
		СтрокаТЧ.СчетЗатрат = ПланыСчетов.абс_МеждународныйОСРЖД.НайтиПоКоду("Р"+Способ.СчетЗатрат.Код);
		СтрокаТЧ.Субконто1 = Способ.Субконто1;
		СтрокаТЧ.Субконто2 = Способ.Субконто2;
		СтрокаТЧ.Субконто3 = Способ.Субконто3;
		ВидыСубконто = СтрокаТЧ.СчетЗатрат.ВидыСубконто;
		КоличествоСубконто = ВидыСубконто.Количество();
		Для Сч = 1 По КоличествоСубконто Цикл
			Если СтрокаТЧ["Субконто"+Сч]=Неопределено Или Не ЗначениеЗаполнено(СтрокаТЧ["Субконто"+Сч]) Тогда
				Если ВидыСубконто[Сч-1].ВидСубконто=ПланыВидовХарактеристик.ВидыСубконтоХозрасчетные.СтатьиЗатрат Тогда
					СтрокаТЧ["Субконто"+Сч] = Способ.СтатьяЗатрат;
				ИначеЕсли ВидыСубконто[Сч-1].ВидСубконто=ПланыВидовХарактеристик.ВидыСубконтоХозрасчетные.НоменклатурныеГруппы Тогда
					СтрокаТЧ["Субконто"+Сч] = Способ.НоменклатурнаяГруппа;
				ИначеЕсли ВидыСубконто[Сч-1].ВидСубконто=ПланыВидовХарактеристик.ВидыСубконтоХозрасчетные.Подразделения Тогда
					СтрокаТЧ["Субконто"+Сч] = Способ.ПодразделениеОрганизации;
				КонецЕсли;
			КонецЕсли;
		КонецЦикла;
		
	КонецЦикла;
	
	Для Каждого СтрокаКоэффициента Из ДокОснование.РаспределениеПоКоэффициентам Цикл
		СтрокаТЧ = ОсновныеСредства.Найти(СтрокаКоэффициента.НовоеОсновноеСредство, "ОсновноеСредство");
		Если СтрокаТЧ<>Неопределено Тогда
			СтрокаТЧ.Коэффициент = СтрокаКоэффициента.Коэффициент;
		КонецЕсли;
	КонецЦикла;
	
    //ТаблицыДанных = Новый Структура;
	//
	//Запрос = Новый Запрос;
	//Запрос.УстановитьПараметр("ДокументОснование", ДанныеЗаполнения);
	//Запрос.УстановитьПараметр("ОсновноеСредство", ДанныеЗаполнения.СтароеОсновноеСредство);
	//Запрос.УстановитьПараметр("Период", ДанныеЗаполнения.Дата);
	//Запрос.УстановитьПараметр("ПустыеСубконто", абс_МеждународныйУчетОСРЖД.ПолучитьСписокПустыхСубконто(ПланыВидовХарактеристик.ВидыСубконтоХозрасчетные));
	//
	//ТекстыЗапросов = Новый СписокЗначений;
	//ТекстыЗапросов.Добавить(абс_МеждународныйУчетОСРЖД.ТекстЗапросаСоответствиеСчетовХозрасчетныйМеждународныйОСРЖД("Период", "ПустыеСубконто", "СоответствиеСчетовХозрасчетныйМеждународный"), "");
	//ТекстыЗапросов.Добавить(абс_МеждународныйУчетОСРЖД.ТекстЗапросаВидыСубконтоСчетов("ВидыСубконтоСчетов"), "");
	//ТекстыЗапросов.Добавить(ТекстЗапросаТабличнаяЧастьОсновныеСредстваОснования(), "");
	//ТекстыЗапросов.Добавить(ТекстЗапросаТабличнаяЧастьРаспределениеОснования(), "");
	//ТекстыЗапросов.Добавить(абс_ВнеоборотныеАктивы.ТекстЗапроса_ОсновныеСредстваРЖДПоОдномуОС("ОсновноеСредство", "Период", "ПараметрыОсновногоСредства"), "");
	//ТекстыЗапросов.Добавить(ТекстЗапросаТаблицаШапка(), "ТаблицаШапка");
	//ТекстыЗапросов.Добавить(ТекстЗапросаТаблицаОсновныеСредства(), "ТаблицаОсновныеСредства");
	//
	//абс_ПроведениеДокументов.ИницализироватьТаблицыДляДвижений(Запрос, ТекстыЗапросов, ТаблицыДанных);
	//
	//Если ТаблицыДанных.Свойство("ТаблицаШапка") И ТаблицыДанных.ТаблицаШапка.Количество()>0 Тогда
	//	ЗаполнитьЗначенияСвойств(ЭтотОбъект, ТаблицыДанных.ТаблицаШапка[0]);
	//КонецЕсли;
	//
	//Если ТаблицыДанных.Свойство("ТаблицаОсновныеСредства") Тогда
	//	ОсновныеСредства.Загрузить(ТаблицыДанных.ТаблицаОсновныеСредства);
	//КонецЕсли;
	
КонецПроцедуры

Процедура ЗаполнитьШапкуИОчиститьТЧ(ДокОснование)
	
	Дата = ДокОснование.Дата;
	Организация = ДокОснование.Организация;
	ДокументОснование = ДокОснование.Ссылка;
	Ответственный = ПараметрыСеанса.ТекущийПользователь;
	
	Если Номер = "" Тогда
		УстановитьНовыйНомер(Организация.Префикс);
	КонецЕсли;
	
	ОсновныеСредства.Очистить();
	
КонецПроцедуры

//////////////////////////////////////////////////////////////////////////
// Прочие процедуры и функции

Функция ПолучитьПустыеСубконто()

	ПустыеСубконто = Новый СписокЗначений;
	ВыборкаСубконто = ПланыВидовХарактеристик.ВидыСубконтоХозрасчетные.Выбрать();
	Пока ВыборкаСубконто.Следующий() Цикл
		ПустыеСубконто.Добавить(ВыборкаСубконто.ТипЗначения.ПривестиЗначение());
	КонецЦикла;
	ПустыеСубконто.Добавить(Неопределено);
	
	Возврат ПустыеСубконто;

КонецФункции // ПолучитьПустыеСубконто()


















//////////////////////////////////////////////////////////////////////////////////
// Функции текстов запросов для процедур заполнения

Функция ТекстЗапросаТабличнаяЧастьОсновныеСредстваОснования()
	
	Возврат "ВЫБРАТЬ
	        |	абс_РазукрупнениеОСОС.ОсновноеСредство,
	        |	абс_РазукрупнениеОСОС.СчетУчетаБУ,
	        |	абс_РазукрупнениеОСОС.СчетАмортизацииБУ КАК СчетНачисленияАмортизацииБУ,
	        |	абс_РазукрупнениеОСОС.Ссылка.ПодразделениеОрганизации КАК Местонахождение,
	        |	абс_РазукрупнениеОСОС.МОЛРегл КАК МОЛ,
	        |	абс_РазукрупнениеОСОС.КоэффициентУскоренияБУ КАК КоэффициентУскорения,
	        |	абс_РазукрупнениеОСОС.НачислятьАмортизациюБУ КАК НачислятьАмортизацию,
	        |	абс_РазукрупнениеОСОС.ДатаПринятияКУчетуРегл КАК ДатаПринятияКУчету,
	        |	абс_РазукрупнениеОСОС.ОсновноеСредство.КодПоОКОФ КАК ОКОФ,
	        |	абс_РазукрупнениеОСОС.ОсновноеСредство.абс_ГруппаОСРЖД КАК ГруппаОСРЖД,
	        |	абс_РазукрупнениеОСОС.СпособОтраженияРасходовПоАмортизацииБУ КАК СпособОтраженияРасходовПоАмортизации
	        |ПОМЕСТИТЬ ТабличнаяЧастьОсновныеСредстваОснования
	        |ИЗ
	        |	Документ.абс_РазукрупнениеОС.ОС КАК абс_РазукрупнениеОСОС
	        |ГДЕ
	        |	абс_РазукрупнениеОСОС.Ссылка = &ДокументОснование
			|;
			|";
	
КонецФункции

Функция ТекстЗапросаТабличнаяЧастьРаспределениеОснования()
	
	Возврат "ВЫБРАТЬ
	        |	абс_РазукрупнениеОСРаспределениеПоКоэффициентам.НовоеОсновноеСредство КАК ОсновноеСредство,
	        |	абс_РазукрупнениеОСРаспределениеПоКоэффициентам.Коэффициент
	        |ПОМЕСТИТЬ ТабличнаяЧастьРаспределениеОснования
	        |ИЗ
	        |	Документ.абс_РазукрупнениеОС.РаспределениеПоКоэффициентам КАК абс_РазукрупнениеОСРаспределениеПоКоэффициентам
	        |ГДЕ
	        |	абс_РазукрупнениеОСРаспределениеПоКоэффициентам.Ссылка = &ДокументОснование
	        |
	        |ИНДЕКСИРОВАТЬ ПО
	        |	ОсновноеСредство
			|;
			|";
	
КонецФункции

Функция ТекстЗапросаТаблицаШапка()
	
	Возврат "ВЫБРАТЬ
	        |	абс_РазукрупнениеОС.Ссылка КАК ДокументОснование,
	        |	абс_РазукрупнениеОС.Дата,
	        |	абс_РазукрупнениеОС.Организация,
	        |	абс_РазукрупнениеОС.СтароеОсновноеСредство КАК ОсновноеСредство
	        |ИЗ
	        |	Документ.абс_РазукрупнениеОС КАК абс_РазукрупнениеОС
	        |ГДЕ
	        |	абс_РазукрупнениеОС.Ссылка = &ДокументОснование
			|;
			|";
	
КонецФункции

Функция ТекстЗапросаТаблицаОсновныеСредства()
	
	Возврат "ВЫБРАТЬ
	        |	ТабличнаяЧастьОсновныеСредстваОснования.ОсновноеСредство,
	        |	ТабличнаяЧастьРаспределениеОснования.Коэффициент,
	        |	ЕСТЬNULL(ПараметрыОсновногоСредства.СчетУчета, ЕСТЬNULL(СчетаУчета.СчетМеждународный, ЗНАЧЕНИЕ(ПланСчетов.абс_МеждународныйОСРЖД.ОсновныеСредстваВОрганизации))) КАК СчетУчета,
	        |	ЕСТЬNULL(ПараметрыОсновногоСредства.СчетНачисленияАмортизации, ЕСТЬNULL(СчетаАмортизации.СчетМеждународный, ЗНАЧЕНИЕ(ПланСчетов.абс_МеждународныйОСРЖД.АмортизацияОсновныхСредствНа01))) КАК СчетНачисленияАмортизации,
	        |	ЕСТЬNULL(ПараметрыОсновногоСредства.СчетЗатрат, СчетаЗатрат.СчетМеждународный) КАК СчетЗатрат,
	        |	ВЫБОР
	        |		КОГДА ПараметрыОсновногоСредства.Субконто1 ЕСТЬ NULL 
	        |			ТОГДА ВЫБОР
	        |					КОГДА ВидыСубконтоСчетовЗатрат.ВидСубконто1 ЕСТЬ NULL 
	        |							ИЛИ ВидыСубконтоСчетовЗатрат.ВидСубконто1 = ЗНАЧЕНИЕ(ПланВидовХарактеристик.ВидыСубконтоХозрасчетные.ПустаяСсылка)
	        |						ТОГДА НЕОПРЕДЕЛЕНО
	        |					КОГДА ВидыСубконтоСчетовЗатрат.ВидСубконто1 = ЗНАЧЕНИЕ(ПланВидовХарактеристик.ВидыСубконтоХозрасчетные.НоменклатурныеГруппы)
	        |						ТОГДА СпособыОтраженияРасходовПоАмортизацииСпособы.НоменклатурнаяГруппа
	        |					КОГДА ВидыСубконтоСчетовЗатрат.ВидСубконто1 = ЗНАЧЕНИЕ(ПланВидовХарактеристик.ВидыСубконтоХозрасчетные.СтатьиЗатрат)
	        |						ТОГДА СпособыОтраженияРасходовПоАмортизацииСпособы.СтатьяЗатрат
	        |					КОГДА ВидыСубконтоСчетовЗатрат.ВидСубконто1 = ЗНАЧЕНИЕ(ПланВидовХарактеристик.ВидыСубконтоХозрасчетные.ОбъектыСтроительства)
	        |						ТОГДА СпособыОтраженияРасходовПоАмортизацииСпособы.ОбъектСтроительства
	        |					КОГДА ВидыСубконтоСчетовЗатрат.ВидСубконто1 = ЗНАЧЕНИЕ(ПланВидовХарактеристик.ВидыСубконтоХозрасчетные.СпособыСтроительства)
	        |						ТОГДА СпособыОтраженияРасходовПоАмортизацииСпособы.СпособСтроительства
	        |					КОГДА ВидыСубконтоСчетовЗатрат.ВидСубконто1 = ЗНАЧЕНИЕ(ПланВидовХарактеристик.ВидыСубконтоХозрасчетные.Подразделения)
	        |						ТОГДА СпособыОтраженияРасходовПоАмортизацииСпособы.ПодразделениеОрганизации
	        |					КОГДА ВидыСубконтоСчетовЗатрат.ВидСубконто1 = ЗНАЧЕНИЕ(ПланВидовХарактеристик.ВидыСубконтоХозрасчетные.Номенклатура)
	        |						ТОГДА СпособыОтраженияРасходовПоАмортизацииСпособы.Продукция
	        |					КОГДА ВидыСубконтоСчетовЗатрат.ВидСубконто1 = ЗНАЧЕНИЕ(ПланВидовХарактеристик.ВидыСубконтоХозрасчетные.ВидыДеятельности)
	        |						ТОГДА СпособыОтраженияРасходовПоАмортизацииСпособы.Субконто3
	        |					ИНАЧЕ СпособыОтраженияРасходовПоАмортизацииСпособы.Субконто1
	        |				КОНЕЦ
	        |		ИНАЧЕ ПараметрыОсновногоСредства.Субконто1
	        |	КОНЕЦ КАК Субконто1,
	        |	ВЫБОР
	        |		КОГДА ПараметрыОсновногоСредства.Субконто2 ЕСТЬ NULL 
	        |			ТОГДА ВЫБОР
	        |					КОГДА ВидыСубконтоСчетовЗатрат.ВидСубконто2 ЕСТЬ NULL 
	        |							ИЛИ ВидыСубконтоСчетовЗатрат.ВидСубконто2 = ЗНАЧЕНИЕ(ПланВидовХарактеристик.ВидыСубконтоХозрасчетные.ПустаяСсылка)
	        |						ТОГДА НЕОПРЕДЕЛЕНО
	        |					КОГДА ВидыСубконтоСчетовЗатрат.ВидСубконто2 = ЗНАЧЕНИЕ(ПланВидовХарактеристик.ВидыСубконтоХозрасчетные.НоменклатурныеГруппы)
	        |						ТОГДА СпособыОтраженияРасходовПоАмортизацииСпособы.НоменклатурнаяГруппа
	        |					КОГДА ВидыСубконтоСчетовЗатрат.ВидСубконто2 = ЗНАЧЕНИЕ(ПланВидовХарактеристик.ВидыСубконтоХозрасчетные.СтатьиЗатрат)
	        |						ТОГДА СпособыОтраженияРасходовПоАмортизацииСпособы.СтатьяЗатрат
	        |					КОГДА ВидыСубконтоСчетовЗатрат.ВидСубконто2 = ЗНАЧЕНИЕ(ПланВидовХарактеристик.ВидыСубконтоХозрасчетные.ОбъектыСтроительства)
	        |						ТОГДА СпособыОтраженияРасходовПоАмортизацииСпособы.ОбъектСтроительства
	        |					КОГДА ВидыСубконтоСчетовЗатрат.ВидСубконто2 = ЗНАЧЕНИЕ(ПланВидовХарактеристик.ВидыСубконтоХозрасчетные.СпособыСтроительства)
	        |						ТОГДА СпособыОтраженияРасходовПоАмортизацииСпособы.СпособСтроительства
	        |					КОГДА ВидыСубконтоСчетовЗатрат.ВидСубконто2 = ЗНАЧЕНИЕ(ПланВидовХарактеристик.ВидыСубконтоХозрасчетные.Подразделения)
	        |						ТОГДА СпособыОтраженияРасходовПоАмортизацииСпособы.ПодразделениеОрганизации
	        |					КОГДА ВидыСубконтоСчетовЗатрат.ВидСубконто2 = ЗНАЧЕНИЕ(ПланВидовХарактеристик.ВидыСубконтоХозрасчетные.Номенклатура)
	        |						ТОГДА СпособыОтраженияРасходовПоАмортизацииСпособы.Продукция
	        |					КОГДА ВидыСубконтоСчетовЗатрат.ВидСубконто2 = ЗНАЧЕНИЕ(ПланВидовХарактеристик.ВидыСубконтоХозрасчетные.ВидыДеятельности)
	        |						ТОГДА СпособыОтраженияРасходовПоАмортизацииСпособы.Субконто3
	        |					ИНАЧЕ СпособыОтраженияРасходовПоАмортизацииСпособы.Субконто2
	        |				КОНЕЦ
	        |		ИНАЧЕ ПараметрыОсновногоСредства.Субконто2
	        |	КОНЕЦ КАК Субконто2,
	        |	ВЫБОР
	        |		КОГДА ПараметрыОсновногоСредства.Субконто3 ЕСТЬ NULL 
	        |			ТОГДА ВЫБОР
	        |					КОГДА ВидыСубконтоСчетовЗатрат.ВидСубконто3 ЕСТЬ NULL 
	        |							ИЛИ ВидыСубконтоСчетовЗатрат.ВидСубконто3 = ЗНАЧЕНИЕ(ПланВидовХарактеристик.ВидыСубконтоХозрасчетные.ПустаяСсылка)
	        |						ТОГДА НЕОПРЕДЕЛЕНО
	        |					КОГДА ВидыСубконтоСчетовЗатрат.ВидСубконто3 = ЗНАЧЕНИЕ(ПланВидовХарактеристик.ВидыСубконтоХозрасчетные.НоменклатурныеГруппы)
	        |						ТОГДА СпособыОтраженияРасходовПоАмортизацииСпособы.НоменклатурнаяГруппа
	        |					КОГДА ВидыСубконтоСчетовЗатрат.ВидСубконто3 = ЗНАЧЕНИЕ(ПланВидовХарактеристик.ВидыСубконтоХозрасчетные.СтатьиЗатрат)
	        |						ТОГДА СпособыОтраженияРасходовПоАмортизацииСпособы.СтатьяЗатрат
	        |					КОГДА ВидыСубконтоСчетовЗатрат.ВидСубконто3 = ЗНАЧЕНИЕ(ПланВидовХарактеристик.ВидыСубконтоХозрасчетные.ОбъектыСтроительства)
	        |						ТОГДА СпособыОтраженияРасходовПоАмортизацииСпособы.ОбъектСтроительства
	        |					КОГДА ВидыСубконтоСчетовЗатрат.ВидСубконто3 = ЗНАЧЕНИЕ(ПланВидовХарактеристик.ВидыСубконтоХозрасчетные.СпособыСтроительства)
	        |						ТОГДА СпособыОтраженияРасходовПоАмортизацииСпособы.СпособСтроительства
	        |					КОГДА ВидыСубконтоСчетовЗатрат.ВидСубконто3 = ЗНАЧЕНИЕ(ПланВидовХарактеристик.ВидыСубконтоХозрасчетные.Подразделения)
	        |						ТОГДА СпособыОтраженияРасходовПоАмортизацииСпособы.ПодразделениеОрганизации
	        |					КОГДА ВидыСубконтоСчетовЗатрат.ВидСубконто3 = ЗНАЧЕНИЕ(ПланВидовХарактеристик.ВидыСубконтоХозрасчетные.Номенклатура)
	        |						ТОГДА СпособыОтраженияРасходовПоАмортизацииСпособы.Продукция
	        |					КОГДА ВидыСубконтоСчетовЗатрат.ВидСубконто3 = ЗНАЧЕНИЕ(ПланВидовХарактеристик.ВидыСубконтоХозрасчетные.ВидыДеятельности)
	        |						ТОГДА СпособыОтраженияРасходовПоАмортизацииСпособы.Субконто3
	        |					ИНАЧЕ СпособыОтраженияРасходовПоАмортизацииСпособы.Субконто3
	        |				КОНЕЦ
	        |		ИНАЧЕ ПараметрыОсновногоСредства.Субконто3
	        |	КОНЕЦ КАК Субконто3,
	        |	ЕСТЬNULL(ПараметрыОсновногоСредства.СчетСниженияСтоимости, ЗНАЧЕНИЕ(ПланСчетов.абс_МеждународныйОСРЖД.Служебный)) КАК СчетСниженияСтоимости,
	        |	ЕСТЬNULL(ПараметрыОсновногоСредства.МОЛ, ТабличнаяЧастьОсновныеСредстваОснования.МОЛ) КАК МОЛ,
	        |	ЕСТЬNULL(ПараметрыОсновногоСредства.МестонахождениеОбъекта, ТабличнаяЧастьОсновныеСредстваОснования.Местонахождение) КАК Местонахождение,
	        |	ЕСТЬNULL(ПараметрыОсновногоСредства.КоэффициентУскорения, ТабличнаяЧастьОсновныеСредстваОснования.КоэффициентУскорения) КАК КоэффициентУскорения,
	        |	ЕСТЬNULL(ПараметрыОсновногоСредства.НачислятьАмортизацию, ТабличнаяЧастьОсновныеСредстваОснования.НачислятьАмортизацию) КАК НачислятьАмортизацию,
	        |	ЕСТЬNULL(ПараметрыОсновногоСредства.СрокПолезногоИспользования, ЕСТЬNULL(абс_СоответствиеОКОФГруппОСРЖД.СрокПолезногоИспользования, 0)) КАК СрокПолезногоИспользования,
	        |	ЕСТЬNULL(ПараметрыОсновногоСредства.ДатаПринятияКУчету, ТабличнаяЧастьОсновныеСредстваОснования.ДатаПринятияКУчету) КАК ДатаПринятияКУчету
	        |ИЗ
	        |	ТабличнаяЧастьОсновныеСредстваОснования КАК ТабличнаяЧастьОсновныеСредстваОснования
	        |		ЛЕВОЕ СОЕДИНЕНИЕ ТабличнаяЧастьРаспределениеОснования КАК ТабличнаяЧастьРаспределениеОснования
	        |		ПО ТабличнаяЧастьОсновныеСредстваОснования.ОсновноеСредство = ТабличнаяЧастьРаспределениеОснования.ОсновноеСредство
	        |		ЛЕВОЕ СОЕДИНЕНИЕ ПараметрыОсновногоСредства КАК ПараметрыОсновногоСредства
	        |		ПО ТабличнаяЧастьОсновныеСредстваОснования.ОсновноеСредство = ПараметрыОсновногоСредства.ОсновноеСредство
	        |		ЛЕВОЕ СОЕДИНЕНИЕ СоответствиеСчетовХозрасчетныйМеждународный КАК СчетаУчета
	        |		ПО ТабличнаяЧастьОсновныеСредстваОснования.СчетУчетаБУ = СчетаУчета.СчетХозрасчетный
	        |			И (СчетаУчета.ВидДвижения = ЗНАЧЕНИЕ(Перечисление.ВидыДвиженийБухгалтерии.Дебет))
	        |		ЛЕВОЕ СОЕДИНЕНИЕ СоответствиеСчетовХозрасчетныйМеждународный КАК СчетаАмортизации
	        |		ПО ТабличнаяЧастьОсновныеСредстваОснования.СчетНачисленияАмортизацииБУ = СчетаАмортизации.СчетХозрасчетный
	        |			И (СчетаАмортизации.ВидДвижения = ЗНАЧЕНИЕ(Перечисление.ВидыДвиженийБухгалтерии.Кредит))
	        |		ЛЕВОЕ СОЕДИНЕНИЕ Справочник.СпособыОтраженияРасходовПоАмортизации.Способы КАК СпособыОтраженияРасходовПоАмортизацииСпособы
	        |			ЛЕВОЕ СОЕДИНЕНИЕ СоответствиеСчетовХозрасчетныйМеждународный КАК СчетаЗатрат
	        |				ЛЕВОЕ СОЕДИНЕНИЕ ВидыСубконтоСчетов КАК ВидыСубконтоСчетовЗатрат
	        |				ПО СчетаЗатрат.СчетМеждународный = ВидыСубконтоСчетовЗатрат.Счет
	        |			ПО СпособыОтраженияРасходовПоАмортизацииСпособы.СчетЗатрат = СчетаЗатрат.СчетХозрасчетный
	        |				И (СчетаЗатрат.ВидДвижения = ЗНАЧЕНИЕ(Перечисление.ВидыДвиженийБухгалтерии.Дебет))
	        |		ПО ТабличнаяЧастьОсновныеСредстваОснования.СпособОтраженияРасходовПоАмортизации = СпособыОтраженияРасходовПоАмортизацииСпособы.Ссылка
	        |		ЛЕВОЕ СОЕДИНЕНИЕ РегистрСведений.абс_СоответствиеОКОФГруппОСРЖД КАК абс_СоответствиеОКОФГруппОСРЖД
	        |		ПО ТабличнаяЧастьОсновныеСредстваОснования.ОКОФ = абс_СоответствиеОКОФГруппОСРЖД.ОКОФ
	        |			И ТабличнаяЧастьОсновныеСредстваОснования.ГруппаОСРЖД = абс_СоответствиеОКОФГруппОСРЖД.ГруппаОСРЖД
			|;
			|";
	
КонецФункции
