

////////////////////////////////////////////////////////////////////////////////
// ВСПОМОГАТЕЛЬНЫЕ ПРОЦЕДУРЫ И ФУНКЦИИ

Процедура ЗаполнитьДанныеСотрудника(ТекущаяСтрока = Неопределено)
	
	Запрос = Новый Запрос;
	Запрос.Текст = 
	"ВЫБРАТЬ
	|	СотрудникиОрганизаций.Физлицо,
	|	СотрудникиОрганизаций.Физлицо.ДатаРождения КАК ДатаРождения,
	|	СотрудникиОрганизаций.Физлицо.ИНН КАК ИНН,
	|	СотрудникиОрганизаций.Физлицо.СтраховойНомерПФР КАК СтраховойНомерПФР,
	|	СотрудникиОрганизаций.Физлицо.Пол КАК Пол,
	|	СотрудникиОрганизаций.Ссылка
	|ПОМЕСТИТЬ ВТСотрудник
	|ИЗ
	|	Справочник.СотрудникиОрганизаций КАК СотрудникиОрганизаций
	|ГДЕ
	|	СотрудникиОрганизаций.Ссылка В(&Ссылки)
	|;
	|
	|////////////////////////////////////////////////////////////////////////////////
	|ВЫБРАТЬ
	|	СтатусФизЛицКакНалогоплательщиковНДФЛСрезПоследних.ФизЛицо,
	|	СтатусФизЛицКакНалогоплательщиковНДФЛСрезПоследних.Статус
	|ПОМЕСТИТЬ ВТСтатусыНалогоплательщика
	|ИЗ
	|	РегистрСведений.СтатусФизЛицКакНалогоплательщиковНДФЛ.СрезПоследних(
	|			&ДатаАктуальности,
	|			ФизЛицо В
	|				(ВЫБРАТЬ
	|					СотрудникиОрганизаций.Физлицо
	|				ИЗ
	|					ВТСотрудник КАК СотрудникиОрганизаций)) КАК СтатусФизЛицКакНалогоплательщиковНДФЛСрезПоследних
	|;
	|
	|////////////////////////////////////////////////////////////////////////////////
	|ВЫБРАТЬ
	|	"","" + АдресаРегистрации.Поле1 + "","" + АдресаРегистрации.Поле2 + "","" + АдресаРегистрации.Поле3 + "","" + АдресаРегистрации.Поле4 + "","" + АдресаРегистрации.Поле5 + "","" + АдресаРегистрации.Поле6 + "","" + АдресаРегистрации.Поле7 + "","" + АдресаРегистрации.Поле8 + "","" + АдресаРегистрации.Поле9 + "","" + ВЫБОР
	|		КОГДА АдресаРегистрации.ТипДома В (ЗНАЧЕНИЕ(Перечисление.ТипыДомов.Дом), ЗНАЧЕНИЕ(Перечисление.ТипыДомов.ПустаяСсылка))
	|			ТОГДА ""дом""
	|		ИНАЧЕ ""владение""
	|	КОНЕЦ + "","" + ВЫБОР
	|		КОГДА АдресаРегистрации.ТипКорпуса В (ЗНАЧЕНИЕ(Перечисление.ТипыКорпусов.Корпус), ЗНАЧЕНИЕ(Перечисление.ТипыКорпусов.ПустаяСсылка))
	|			ТОГДА ""корпус""
	|		ИНАЧЕ ""строение""
	|	КОНЕЦ + "","" + ВЫБОР
	|		КОГДА АдресаРегистрации.ТипКвартиры В (ЗНАЧЕНИЕ(Перечисление.ТипыКвартир.Квартира), ЗНАЧЕНИЕ(Перечисление.ТипыКвартир.ПустаяСсылка))
	|			ТОГДА ""кв.""
	|		ИНАЧЕ ""оф.""
	|	КОНЕЦ КАК АдресРегистрации,
	|	Сотрудник.Физлицо,
	|	Сотрудник.ДатаРождения,
	|	Сотрудник.ИНН,
	|	Сотрудник.СтраховойНомерПФР,
	|	Сотрудник.Пол,
	|	Сотрудник.Ссылка,
	|	ЕСТЬNULL(СтатусыНалогоплательщика.Статус, ЗНАЧЕНИЕ(Перечисление.СтатусыНалогоплательщиковПоНДФЛ.Резидент)) КАК СтатусНалогоплательщика
	|ИЗ
	|	ВТСотрудник КАК Сотрудник
	|		ЛЕВОЕ СОЕДИНЕНИЕ ВТСтатусыНалогоплательщика КАК СтатусыНалогоплательщика
	|		ПО Сотрудник.Физлицо = СтатусыНалогоплательщика.ФизЛицо
	|		ЛЕВОЕ СОЕДИНЕНИЕ РегистрСведений.КонтактнаяИнформация КАК АдресаРегистрации
	|		ПО Сотрудник.Физлицо = АдресаРегистрации.Объект
	|			И (АдресаРегистрации.Вид = ЗНАЧЕНИЕ(Справочник.ВидыКонтактнойИнформации.ЮрАдресФизЛица))
	|			И (АдресаРегистрации.Тип = ЗНАЧЕНИЕ(Перечисление.ТипыКонтактнойИнформации.Адрес))";
	Запрос.УстановитьПараметр("ДатаАктуальности", Дата);
	Если ТекущаяСтрока = Неопределено Тогда
		Запрос.УстановитьПараметр("Ссылки", РаботникиОрганизации.ВыгрузитьКолонку("Сотрудник"));
		Выборка = Запрос.Выполнить().Выбрать();
		СтруктураПоиска = Новый Структура("Сотрудник");
		Пока Выборка.Следующий() Цикл
			СтруктураПоиска.Сотрудник = Выборка.Ссылка;
			СтрокиТЧ = РаботникиОрганизации.НайтиСтроки(СтруктураПоиска);
			Для каждого СтрокаТЧ Из СтрокиТЧ Цикл
				ЗаполнитьЗначенияСвойств(СтрокаТЧ, Выборка);
			КонецЦикла;
		КонецЦикла;
	Иначе
		Запрос.УстановитьПараметр("Ссылки", ТекущаяСтрока.Сотрудник);
		Выборка = Запрос.Выполнить().Выбрать();
		Если Выборка.Следующий() Тогда
			ЗаполнитьЗначенияСвойств(ТекущаяСтрока, Выборка);
		КонецЕсли;
	КонецЕсли;
	
КонецПроцедуры

Процедура ЗаполнитьДанныеБольничного(ТекущаяСтрока = Неопределено)

	Запрос = Новый Запрос;
	Запрос.Текст = 
	"ВЫБРАТЬ
	|	НачислениеПоБольничномуЛисту.Ссылка,
	|	НачислениеПоБольничномуЛисту.Сотрудник,
	|	НачислениеПоБольничномуЛисту.ДатаНачалаСобытия
	|ПОМЕСТИТЬ ВТДокументыЗаполнения
	|ИЗ
	|	Документ.НачислениеПоБольничномуЛисту КАК НачислениеПоБольничномуЛисту
	|		ЛЕВОЕ СОЕДИНЕНИЕ Документ.РеестрСведенийВФССОПособияхПоНетрудоспособности.РаботникиОрганизации КАК РеестрСведенийВФССОПособияхПоНетрудоспособностиРаботникиОрганизации
	|		ПО НачислениеПоБольничномуЛисту.Ссылка = РеестрСведенийВФССОПособияхПоНетрудоспособностиРаботникиОрганизации.ЛистокНетрудоспособности
	|			И (РеестрСведенийВФССОПособияхПоНетрудоспособностиРаботникиОрганизации.Ссылка <> &ТекущийРеестр)
	|			И (РеестрСведенийВФССОПособияхПоНетрудоспособностиРаботникиОрганизации.Ссылка.Проведен)
	|ГДЕ
	|	НачислениеПоБольничномуЛисту.Проведен
	|	И НачислениеПоБольничномуЛисту.ПериодРегистрации >= &ДатаПередачиФССВыплатыПособий
	|	И &ЗаполнятьВсемиДокументами
	|	И НачислениеПоБольничномуЛисту.Организация = &Организация
	|	И НачислениеПоБольничномуЛисту.ПричинаНетрудоспособности <> ЗНАЧЕНИЕ(Перечисление.ПричиныНетрудоспособности.ТравмаНаПроизводстве)
	|	И (НачислениеПоБольничномуЛисту.ПричинаНетрудоспособности <> ЗНАЧЕНИЕ(Перечисление.ПричиныНетрудоспособности.ОбщееЗаболевание)
	|			ИЛИ ДОБАВИТЬКДАТЕ(НачислениеПоБольничномуЛисту.ДатаНачалаСобытия, ДЕНЬ, НачислениеПоБольничномуЛисту.ДнейОплатыРаботодателем) <= ДОБАВИТЬКДАТЕ(НачислениеПоБольничномуЛисту.ДатаНачалаОплаты, ДЕНЬ, НачислениеПоБольничномуЛисту.ДнейОплаты - 1))
	|	И РеестрСведенийВФССОПособияхПоНетрудоспособностиРаботникиОрганизации.Сотрудник ЕСТЬ NULL 
	|
	|ОБЪЕДИНИТЬ ВСЕ
	|
	|ВЫБРАТЬ
	|	НачислениеПоБольничномуЛисту.Ссылка,
	|	НачислениеПоБольничномуЛисту.Сотрудник,
	|	НачислениеПоБольничномуЛисту.ДатаНачалаСобытия
	|ИЗ
	|	Документ.НачислениеПоБольничномуЛисту КАК НачислениеПоБольничномуЛисту
	|ГДЕ
	|	НачислениеПоБольничномуЛисту.Ссылка = &Ссылка
	|;
	|
	|////////////////////////////////////////////////////////////////////////////////
	|ВЫБРАТЬ
	|	ВЫБОР
	|		КОГДА РаботникиОрганизаций.ПериодЗавершения <= ДатыРегистра.ДатаНачалаСобытия
	|				И РаботникиОрганизаций.ПериодЗавершения <> ДАТАВРЕМЯ(1, 1, 1, 0, 0, 0)
	|			ТОГДА ВЫБОР
	|					КОГДА РаботникиОрганизаций.ГрафикРаботыЗавершения.СокращенноеРабочееВремя
	|							И РаботникиОрганизаций.ГрафикРаботыЗавершения.ГрафикПолногоРабочегоВремени <> ЗНАЧЕНИЕ(Справочник.ГрафикиРаботы.ПустаяСсылка)
	|							И РаботникиОрганизаций.ГрафикРаботыЗавершения.ГрафикПолногоРабочегоВремени.ДлительностьРабочейНедели <> 0
	|						ТОГДА РаботникиОрганизаций.ГрафикРаботыЗавершения.ДлительностьРабочейНедели / РаботникиОрганизаций.ГрафикРаботыЗавершения.ГрафикПолногоРабочегоВремени.ДлительностьРабочейНедели
	|					ИНАЧЕ 0
	|				КОНЕЦ
	|		КОГДА РаботникиОрганизаций.ГрафикРаботы.СокращенноеРабочееВремя
	|				И РаботникиОрганизаций.ГрафикРаботы.ГрафикПолногоРабочегоВремени <> ЗНАЧЕНИЕ(Справочник.ГрафикиРаботы.ПустаяСсылка)
	|				И РаботникиОрганизаций.ГрафикРаботы.ГрафикПолногоРабочегоВремени.ДлительностьРабочейНедели <> 0
	|			ТОГДА РаботникиОрганизаций.ГрафикРаботы.ДлительностьРабочейНедели / РаботникиОрганизаций.ГрафикРаботы.ГрафикПолногоРабочегоВремени.ДлительностьРабочейНедели
	|		ИНАЧЕ 0
	|	КОНЕЦ КАК ДоляВремени,
	|	ВЫБОР
	|		КОГДА РаботникиОрганизаций.ПериодЗавершения <= ДатыРегистра.ДатаНачалаСобытия
	|				И РаботникиОрганизаций.ПериодЗавершения <> ДАТАВРЕМЯ(1, 1, 1, 0, 0, 0)
	|			ТОГДА ВЫБОР
	|					КОГДА РаботникиОрганизаций.ПодразделениеОрганизацииЗавершения.КодПоОКАТО <> """"
	|						ТОГДА РаботникиОрганизаций.ПодразделениеОрганизацииЗавершения.РайонныйКоэффициентРФ
	|					ИНАЧЕ РаботникиОрганизаций.ОбособленноеПодразделениеЗавершения.РайонныйКоэффициентРФ
	|				КОНЕЦ
	|		КОГДА РаботникиОрганизаций.ПодразделениеОрганизации.КодПоОКАТО <> """"
	|			ТОГДА РаботникиОрганизаций.ПодразделениеОрганизации.РайонныйКоэффициентРФ
	|		ИНАЧЕ РаботникиОрганизаций.ОбособленноеПодразделение.РайонныйКоэффициентРФ
	|	КОНЕЦ КАК РайонныйКоэффициент,
	|	ДатыРегистра.Ссылка
	|ПОМЕСТИТЬ ВТДанныеСотрудника
	|ИЗ
	|	(ВЫБРАТЬ РАЗЛИЧНЫЕ
	|		ДанныеРегистра.Ссылка КАК Ссылка,
	|		ДанныеРегистра.ДатаНачалаСобытия КАК ДатаНачалаСобытия,
	|		ДанныеРегистра.Сотрудник КАК Сотрудник,
	|		МАКСИМУМ(РаботникиОрганизаций.Период) КАК ПериодРегистра
	|	ИЗ
	|		ВТДокументыЗаполнения КАК ДанныеРегистра
	|			ЛЕВОЕ СОЕДИНЕНИЕ РегистрСведений.РаботникиОрганизаций КАК РаботникиОрганизаций
	|			ПО ДанныеРегистра.ДатаНачалаСобытия >= РаботникиОрганизаций.Период
	|				И ДанныеРегистра.Сотрудник = РаботникиОрганизаций.Сотрудник
	|	
	|	СГРУППИРОВАТЬ ПО
	|		ДанныеРегистра.ДатаНачалаСобытия,
	|		ДанныеРегистра.Сотрудник,
	|		ДанныеРегистра.Ссылка) КАК ДатыРегистра
	|		ЛЕВОЕ СОЕДИНЕНИЕ РегистрСведений.РаботникиОрганизаций КАК РаботникиОрганизаций
	|		ПО ДатыРегистра.ПериодРегистра = РаботникиОрганизаций.Период
	|			И ДатыРегистра.Сотрудник = РаботникиОрганизаций.Сотрудник
	|;
	|
	|////////////////////////////////////////////////////////////////////////////////
	|ВЫБРАТЬ
	|	ДатыАктуальностиММОТ.ДатаНачалаСобытия,
	|	МинимальнаяОплатаТрудаРФ.Размер КАК Размер
	|ПОМЕСТИТЬ ВТРазмерММОТНаДатуДатаНачалаСобытия
	|ИЗ
	|	(ВЫБРАТЬ
	|		Основной.ДатаНачалаСобытия КАК ДатаНачалаСобытия,
	|		МАКСИМУМ(МинимальнаяОплатаТрудаРФ.Период) КАК ДатаАктуальности
	|	ИЗ
	|		ВТДокументыЗаполнения КАК Основной
	|			ЛЕВОЕ СОЕДИНЕНИЕ РегистрСведений.МинимальнаяОплатаТрудаРФ КАК МинимальнаяОплатаТрудаРФ
	|			ПО Основной.ДатаНачалаСобытия >= МинимальнаяОплатаТрудаРФ.Период
	|	
	|	СГРУППИРОВАТЬ ПО
	|		Основной.ДатаНачалаСобытия) КАК ДатыАктуальностиММОТ
	|		ЛЕВОЕ СОЕДИНЕНИЕ РегистрСведений.МинимальнаяОплатаТрудаРФ КАК МинимальнаяОплатаТрудаРФ
	|		ПО (МинимальнаяОплатаТрудаРФ.Период = ДатыАктуальностиММОТ.ДатаАктуальности)
	|;
	|
	|////////////////////////////////////////////////////////////////////////////////
	|ВЫБРАТЬ
	|	НачислениеПоБольничномуЛистуУходЗаБольнымЧленомСемьи.НомерСтроки,
	|	НачислениеПоБольничномуЛистуУходЗаБольнымЧленомСемьи.ВозрастЛет,
	|	НачислениеПоБольничномуЛистуУходЗаБольнымЧленомСемьи.ВозрастМесяцев,
	|	НачислениеПоБольничномуЛистуУходЗаБольнымЧленомСемьи.РодственнаяСвязь,
	|	НачислениеПоБольничномуЛистуУходЗаБольнымЧленомСемьи.ФИО,
	|	НачислениеПоБольничномуЛистуУходЗаБольнымЧленомСемьи.Ссылка
	|ПОМЕСТИТЬ ВТУходЗаБольнымЧленомСемьи
	|ИЗ
	|	Документ.НачислениеПоБольничномуЛисту.УходЗаБольнымЧленомСемьи КАК НачислениеПоБольничномуЛистуУходЗаБольнымЧленомСемьи
	|ГДЕ
	|	НачислениеПоБольничномуЛистуУходЗаБольнымЧленомСемьи.Ссылка В
	|			(ВЫБРАТЬ
	|				ДокументыЗаполнения.Ссылка
	|			ИЗ
	|				ВТДокументыЗаполнения КАК ДокументыЗаполнения)
	|	И НачислениеПоБольничномуЛистуУходЗаБольнымЧленомСемьи.НомерСтроки < 3
	|;
	|
	|////////////////////////////////////////////////////////////////////////////////
	|ВЫБРАТЬ
	|	НачислениеПоБольничномуЛистуОсвобождениеОтРаботыВЛисткеНетрудоспособности.НомерСтроки,
	|	НачислениеПоБольничномуЛистуОсвобождениеОтРаботыВЛисткеНетрудоспособности.ДатаНачала,
	|	НачислениеПоБольничномуЛистуОсвобождениеОтРаботыВЛисткеНетрудоспособности.ДатаОкончания,
	|	НачислениеПоБольничномуЛистуОсвобождениеОтРаботыВЛисткеНетрудоспособности.Ссылка,
	|	НачислениеПоБольничномуЛистуОсвобождениеОтРаботыВЛисткеНетрудоспособности.ДолжностьВрача,
	|	НачислениеПоБольничномуЛистуОсвобождениеОтРаботыВЛисткеНетрудоспособности.ФИОВрача,
	|	НачислениеПоБольничномуЛистуОсвобождениеОтРаботыВЛисткеНетрудоспособности.ИдентификационныйНомерВрача,
	|	НачислениеПоБольничномуЛистуОсвобождениеОтРаботыВЛисткеНетрудоспособности.ФИОВрачаПредседателяВК
	|ПОМЕСТИТЬ ВТОсвобождениеОтРаботы
	|ИЗ
	|	Документ.НачислениеПоБольничномуЛисту.ОсвобождениеОтРаботыВЛисткеНетрудоспособности КАК НачислениеПоБольничномуЛистуОсвобождениеОтРаботыВЛисткеНетрудоспособности
	|ГДЕ
	|	НачислениеПоБольничномуЛистуОсвобождениеОтРаботыВЛисткеНетрудоспособности.Ссылка В
	|			(ВЫБРАТЬ
	|				ДокументыЗаполнения.Ссылка
	|			ИЗ
	|				ВТДокументыЗаполнения КАК ДокументыЗаполнения)
	|	И НачислениеПоБольничномуЛистуОсвобождениеОтРаботыВЛисткеНетрудоспособности.НомерСтроки < 4
	|;
	|
	|////////////////////////////////////////////////////////////////////////////////
	|ВЫБРАТЬ
	|	НачислениеПоБольничномуЛистуРасчетСреднего2011.РасчетныйГод,
	|	СУММА(НачислениеПоБольничномуЛистуРасчетСреднего2011.Заработок) КАК Заработок,
	|	НачислениеПоБольничномуЛистуРасчетСреднего2011.Ссылка
	|ПОМЕСТИТЬ ВТРасчет2011
	|ИЗ
	|	Документ.НачислениеПоБольничномуЛисту.РасчетСреднего2011 КАК НачислениеПоБольничномуЛистуРасчетСреднего2011
	|ГДЕ
	|	НачислениеПоБольничномуЛистуРасчетСреднего2011.Ссылка В
	|			(ВЫБРАТЬ
	|				ДокументыЗаполнения.Ссылка
	|			ИЗ
	|				ВТДокументыЗаполнения КАК ДокументыЗаполнения)
	|
	|СГРУППИРОВАТЬ ПО
	|	НачислениеПоБольничномуЛистуРасчетСреднего2011.РасчетныйГод,
	|	НачислениеПоБольничномуЛистуРасчетСреднего2011.Ссылка
	|;
	|
	|////////////////////////////////////////////////////////////////////////////////
	|ВЫБРАТЬ
	|	НачислениеПоБольничномуЛистуГодыРасчетаСреднего2011.НомерСтроки,
	|	НачислениеПоБольничномуЛистуГодыРасчетаСреднего2011.Год,
	|	НачислениеПоБольничномуЛистуГодыРасчетаСреднего2011.Ссылка
	|ПОМЕСТИТЬ ВТГоды2011
	|ИЗ
	|	Документ.НачислениеПоБольничномуЛисту.ГодыРасчетаСреднего2011 КАК НачислениеПоБольничномуЛистуГодыРасчетаСреднего2011
	|ГДЕ
	|	НачислениеПоБольничномуЛистуГодыРасчетаСреднего2011.Ссылка В
	|			(ВЫБРАТЬ
	|				ДокументыЗаполнения.Ссылка
	|			ИЗ
	|				ВТДокументыЗаполнения КАК ДокументыЗаполнения)
	|;
	|
	|////////////////////////////////////////////////////////////////////////////////
	|ВЫБРАТЬ
	|	СУММА(НачислениеПоБольничномуЛистуРасчетСреднего.ОтработаноДней) КАК ОтработаноДней,
	|	СУММА(НачислениеПоБольничномуЛистуРасчетСреднего.Результат) КАК Результат,
	|	НачислениеПоБольничномуЛистуРасчетСреднего.Ссылка
	|ПОМЕСТИТЬ ВТРасчет2010
	|ИЗ
	|	Документ.НачислениеПоБольничномуЛисту.РасчетСреднего КАК НачислениеПоБольничномуЛистуРасчетСреднего
	|ГДЕ
	|	НачислениеПоБольничномуЛистуРасчетСреднего.Ссылка В
	|			(ВЫБРАТЬ
	|				ДокументыЗаполнения.Ссылка
	|			ИЗ
	|				ВТДокументыЗаполнения КАК ДокументыЗаполнения)
	|
	|СГРУППИРОВАТЬ ПО
	|	НачислениеПоБольничномуЛистуРасчетСреднего.Ссылка
	|;
	|
	|////////////////////////////////////////////////////////////////////////////////
	|ВЫБРАТЬ
	|	СУММА(РасчетСреднегоЗаработка.Результат) КАК Результат,
	|	ВЫБОР
	|		КОГДА НАЧАЛОПЕРИОДА(РасчетСреднегоЗаработка.БазовыйПериодНачало, ГОД) < &ДатаЗакона213ФЗ
	|			ТОГДА &ДатаЗакона213ФЗ
	|		ИНАЧЕ НАЧАЛОПЕРИОДА(РасчетСреднегоЗаработка.БазовыйПериодНачало, ГОД)
	|	КОНЕЦ КАК ДатаОграниченияЗаработка,
	|	РасчетСреднегоЗаработка.Регистратор,
	|	НАЧАЛОПЕРИОДА(РасчетСреднегоЗаработка.БазовыйПериодНачало, ГОД) КАК ГодЗаработка
	|ПОМЕСТИТЬ ВТДанныеРегистраСреднего2011
	|ИЗ
	|	РегистрРасчета.РасчетСреднегоЗаработка КАК РасчетСреднегоЗаработка
	|ГДЕ
	|	РасчетСреднегоЗаработка.Регистратор В
	|			(ВЫБРАТЬ
	|				ДокументыЗаполнения.Ссылка
	|			ИЗ
	|				ВТДокументыЗаполнения КАК ДокументыЗаполнения)
	|	И РасчетСреднегоЗаработка.ВидРасчета = &ВидРасчета
	|
	|СГРУППИРОВАТЬ ПО
	|	ВЫБОР
	|		КОГДА НАЧАЛОПЕРИОДА(РасчетСреднегоЗаработка.БазовыйПериодНачало, ГОД) < &ДатаЗакона213ФЗ
	|			ТОГДА &ДатаЗакона213ФЗ
	|		ИНАЧЕ НАЧАЛОПЕРИОДА(РасчетСреднегоЗаработка.БазовыйПериодНачало, ГОД)
	|	КОНЕЦ,
	|	РасчетСреднегоЗаработка.Регистратор,
	|	НАЧАЛОПЕРИОДА(РасчетСреднегоЗаработка.БазовыйПериодНачало, ГОД)
	|;
	|
	|////////////////////////////////////////////////////////////////////////////////
	|ВЫБРАТЬ
	|	ДатыРегистра.ДатаОграниченияЗаработка,
	|	ЕСТЬNULL(ПредельнаяВеличинаБазыСтраховыхВзносов.Размер, 0) КАК Размер
	|ПОМЕСТИТЬ ВТПредельнаяВеличинаЗаработкаПоГодам
	|ИЗ
	|	(ВЫБРАТЬ РАЗЛИЧНЫЕ
	|		ДанныеРегистра.ДатаОграниченияЗаработка КАК ДатаОграниченияЗаработка,
	|		МАКСИМУМ(ПредельнаяВеличинаБазыСтраховыхВзносов.Период) КАК ПериодРегистра
	|	ИЗ
	|		ВТДанныеРегистраСреднего2011 КАК ДанныеРегистра
	|			ЛЕВОЕ СОЕДИНЕНИЕ РегистрСведений.ПредельнаяВеличинаБазыСтраховыхВзносов КАК ПредельнаяВеличинаБазыСтраховыхВзносов
	|			ПО ДанныеРегистра.ДатаОграниченияЗаработка >= ПредельнаяВеличинаБазыСтраховыхВзносов.Период
	|	
	|	СГРУППИРОВАТЬ ПО
	|		ДанныеРегистра.ДатаОграниченияЗаработка) КАК ДатыРегистра
	|		ЛЕВОЕ СОЕДИНЕНИЕ РегистрСведений.ПредельнаяВеличинаБазыСтраховыхВзносов КАК ПредельнаяВеличинаБазыСтраховыхВзносов
	|		ПО ДатыРегистра.ПериодРегистра = ПредельнаяВеличинаБазыСтраховыхВзносов.Период
	|;
	|
	|////////////////////////////////////////////////////////////////////////////////
	|ВЫБРАТЬ
	|	СУММА(ВЫБОР
	|			КОГДА ДанныеРегистраСреднего.Результат <= ПредельнаяВеличинаЗаработка.Размер
	|				ТОГДА ДанныеРегистраСреднего.Результат
	|			ИНАЧЕ ПредельнаяВеличинаЗаработка.Размер
	|		КОНЕЦ) / 730 КАК Заработок,
	|	ДанныеРегистраСреднего.Регистратор
	|ПОМЕСТИТЬ ВТДанныеОСреднемЗаработке2011
	|ИЗ
	|	ВТДанныеРегистраСреднего2011 КАК ДанныеРегистраСреднего
	|		ЛЕВОЕ СОЕДИНЕНИЕ ВТПредельнаяВеличинаЗаработкаПоГодам КАК ПредельнаяВеличинаЗаработка
	|		ПО ДанныеРегистраСреднего.ДатаОграниченияЗаработка = ПредельнаяВеличинаЗаработка.ДатаОграниченияЗаработка
	|
	|СГРУППИРОВАТЬ ПО
	|	ДанныеРегистраСреднего.Регистратор
	|;
	|
	|////////////////////////////////////////////////////////////////////////////////
	|ВЫБРАТЬ
	|	НачислениеПоБольничномуЛисту.Сотрудник КАК Сотрудник,
	|	НачислениеПоБольничномуЛисту.Физлицо,
	|	НачислениеПоБольничномуЛисту.Ссылка КАК ЛистокНетрудоспособности,
	|	3 КАК КоличествоСтраниц,
	|	НачислениеПоБольничномуЛисту.ПеречислятьПособиеПочтовымПереводом,
	|	НачислениеПоБольничномуЛисту.НаименованиеБанка,
	|	НачислениеПоБольничномуЛисту.БИКБанка,
	|	НачислениеПоБольничномуЛисту.НомерЛицевогоСчета,
	|	НачислениеПоБольничномуЛисту.АдресПочтовый,
	|	НачислениеПоБольничномуЛисту.ДатаВыходаНаРаботу,
	|	НачислениеПоБольничномуЛисту.УстановленаИзмененаГруппаИнвалидности,
	|	НачислениеПоБольничномуЛисту.ДатаРегистрацииДокументовМСЭ,
	|	НачислениеПоБольничномуЛисту.КодНарушенияРежима,
	|	НачислениеПоБольничномуЛисту.ПериодНахожденияВСтационареСРебенкомС,
	|	НачислениеПоБольничномуЛисту.ПериодНахожденияВСтационареСРебенкомПо,
	|	НачислениеПоБольничномуЛисту.ДатаСправкиБеременной,
	|	НачислениеПоБольничномуЛисту.ДатаИзмененияКодаПричиныНетрудоспособности,
	|	НачислениеПоБольничномуЛисту.ВторойКодПричиныНетрудоспособности,
	|	НачислениеПоБольничномуЛисту.ДополнительныйКодПричиныНетрудоспособности,
	|	НачислениеПоБольничномуЛисту.КодПричиныНетрудоспособности,
	|	НачислениеПоБольничномуЛисту.ПоставленаНаУчетВРанниеСрокиБеременности,
	|	НачислениеПоБольничномуЛисту.ПериодПростояС,
	|	НачислениеПоБольничномуЛисту.ПериодПростояПо,
	|	НачислениеПоБольничномуЛисту.ДатаДействияДокумента,
	|	НачислениеПоБольничномуЛисту.ДатаВыдачиДокумента,
	|	НачислениеПоБольничномуЛисту.ВидДокумента,
	|	НачислениеПоБольничномуЛисту.СерияДокумента,
	|	НачислениеПоБольничномуЛисту.НомерДокумента,
	|	НачислениеПоБольничномуЛисту.Фамилия КАК Фамилия,
	|	НачислениеПоБольничномуЛисту.Имя КАК Имя,
	|	НачислениеПоБольничномуЛисту.Отчество КАК Отчество,
	|	НачислениеПоБольничномуЛисту.СтажЛет,
	|	НачислениеПоБольничномуЛисту.СтажМесяцев,
	|	ВЫБОР
	|		КОГДА НачислениеПоБольничномуЛисту.СтажБезНестраховыхПериодовЛет = 0
	|			ТОГДА НачислениеПоБольничномуЛисту.СтажЛет
	|		ИНАЧЕ НачислениеПоБольничномуЛисту.СтажБезНестраховыхПериодовЛет
	|	КОНЕЦ КАК СтажБезНестраховыхПериодовЛет,
	|	ВЫБОР
	|		КОГДА НачислениеПоБольничномуЛисту.СтажБезНестраховыхПериодовСтажМесяцев = 0
	|			ТОГДА НачислениеПоБольничномуЛисту.СтажМесяцев
	|		ИНАЧЕ НачислениеПоБольничномуЛисту.СтажБезНестраховыхПериодовСтажМесяцев
	|	КОНЕЦ КАК СтажБезНестраховыхПериодовСтажМесяцев,
	|	НачислениеПоБольничномуЛисту.УсловияИсчисленияКод1,
	|	НачислениеПоБольничномуЛисту.УсловияИсчисленияКод2,
	|	НачислениеПоБольничномуЛисту.УсловияИсчисленияКод3,
	|	ВЫБОР
	|		КОГДА НачислениеПоБольничномуЛисту.ПричинаНетрудоспособности = ЗНАЧЕНИЕ(Перечисление.ПричиныНетрудоспособности.ПоБеременностиИРодам)
	|			ТОГДА ВЫБОР
	|					КОГДА НачислениеПоБольничномуЛисту.РасчетПособияИзТарифнойСтавки
	|						ТОГДА 2
	|					ИНАЧЕ НачислениеПоБольничномуЛисту.РасчетПоПравилам2010Года
	|				КОНЕЦ
	|		ИНАЧЕ 0
	|	КОНЕЦ КАК ПорядокРасчетаСреднегоЗаработка,
	|	НачислениеПоБольничномуЛисту.НомерВходящегоДокумента,
	|	НачислениеПоБольничномуЛисту.ДатаВыдачиБольничного,
	|	НачислениеПоБольничномуЛисту.ПервичныйБольничныйЛист.НомерВходящегоДокумента КАК НомерПервичногоБольничного,
	|	ДОБАВИТЬКДАТЕ(НачислениеПоБольничномуЛисту.ДатаНачалаОплаты, ДЕНЬ, НачислениеПоБольничномуЛисту.ДнейОплаты - 1) КАК ДатаОкончанияОплаты,
	|	НачислениеПоБольничномуЛисту.ДатаНарушенияРежима,
	|	ВЫБОР
	|		КОГДА НачислениеПоБольничномуЛисту.ПричинаНетрудоспособности = ЗНАЧЕНИЕ(Перечисление.ПричиныНетрудоспособности.ОбщееЗаболевание)
	|			ТОГДА ВЫБОР
	|					КОГДА ДОБАВИТЬКДАТЕ(НачислениеПоБольничномуЛисту.ДатаНачалаСобытия, ДЕНЬ, НачислениеПоБольничномуЛисту.ДнейОплатыРаботодателем) > НачислениеПоБольничномуЛисту.ДатаНачалаОплаты
	|						ТОГДА ДОБАВИТЬКДАТЕ(НачислениеПоБольничномуЛисту.ДатаНачалаСобытия, ДЕНЬ, НачислениеПоБольничномуЛисту.ДнейОплатыРаботодателем)
	|					ИНАЧЕ НачислениеПоБольничномуЛисту.ДатаНачалаОплаты
	|				КОНЕЦ
	|		ИНАЧЕ НачислениеПоБольничномуЛисту.ДатаНачалаОплаты
	|	КОНЕЦ КАК ДатаНачалаОплаты,
	|	ПервыйГодРасчета2011.Год КАК ПервыйГодРасчета,
	|	ВторойГодРасчета2011.Год КАК ВторойГодРасчета,
	|	НачислениеПоБольничномуЛисту.КемВыданДокумент,
	|	НачислениеПоБольничномуЛисту.НовыйСтатусНетрудопособного,
	|	НачислениеПоБольничномуЛисту.ДатаНовыйСтатусНетрудопособного,
	|	НачислениеПоБольничномуЛисту.НомерЛисткаПродолжения,
	|	НачислениеПоБольничномуЛисту.ДатаНаправленияВБюроМСЭ,
	|	НачислениеПоБольничномуЛисту.ДатаОсвидетельствованияМСЭ,
	|	НачислениеПоБольничномуЛисту.ДатаОкончанияПутевки,
	|	НачислениеПоБольничномуЛисту.НомерПутевки,
	|	НачислениеПоБольничномуЛисту.ОГРН_Санатория,
	|	НачислениеПоБольничномуЛисту.НомерЛисткаПоОсновномуМестуРаботы,
	|	НачислениеПоБольничномуЛисту.АдресЛПУ,
	|	НачислениеПоБольничномуЛисту.НаименованиеЛПУ,
	|	НачислениеПоБольничномуЛисту.ОГРН_ЛПУ,
	|	НачислениеПоБольничномуЛисту.Банк,
	|	НачислениеПоБольничномуЛисту.ЯвляетсяДубликатом,
	|	ДанныеСотрудника.РайонныйКоэффициент,
	|	НачислениеПоБольничномуЛисту.ПериодРасчетаСреднегоЗаработкаНачало,
	|	НачислениеПоБольничномуЛисту.ПериодРасчетаСреднегоЗаработкаОкончание,
	|	Расчет2010.ОтработаноДней КАК КалендарныхДнейРасчетногоПериода,
	|	УходПервымЧленомСемьи.ВозрастЛет КАК УходЗаРодственникомЛет1,
	|	УходПервымЧленомСемьи.ВозрастМесяцев КАК УходЗаРодственникомМесяцев1,
	|	УходПервымЧленомСемьи.РодственнаяСвязь КАК УходЗаРодственникомРодственнаяСвязь1,
	|	УходПервымЧленомСемьи.ФИО КАК УходЗаРодственникомФИО1,
	|	УходВторымЧленомСемьи.ВозрастЛет КАК УходЗаРодственникомЛет2,
	|	УходВторымЧленомСемьи.ВозрастМесяцев КАК УходЗаРодственникомМесяцев2,
	|	УходВторымЧленомСемьи.РодственнаяСвязь КАК УходЗаРодственникомРодственнаяСвязь2,
	|	УходВторымЧленомСемьи.ФИО КАК УходЗаРодственникомФИО2,
	|	ВЫБОР
	|		КОГДА ПервыйГодРасчета2011.Год = ГОД(НачислениеПоБольничномуЛисту.ДатаНачалаСобытия) - 2
	|				И ВторойГодРасчета2011.Год = ГОД(НачислениеПоБольничномуЛисту.ДатаНачалаСобытия) - 1
	|			ТОГДА 0
	|		КОГДА ПервыйГодРасчета2011.Год <> ГОД(НачислениеПоБольничномуЛисту.ДатаНачалаСобытия) - 2
	|				И ВторойГодРасчета2011.Год <> ГОД(НачислениеПоБольничномуЛисту.ДатаНачалаСобытия) - 2
	|			ТОГДА ГОД(НачислениеПоБольничномуЛисту.ДатаНачалаСобытия) - 2
	|		ИНАЧЕ ГОД(НачислениеПоБольничномуЛисту.ДатаНачалаСобытия) - 1
	|	КОНЕЦ КАК ЗамененныйПервыйГодРасчета,
	|	ВЫБОР
	|		КОГДА ПервыйГодРасчета2011.Год = ГОД(НачислениеПоБольничномуЛисту.ДатаНачалаСобытия) - 2
	|				И ВторойГодРасчета2011.Год = ГОД(НачислениеПоБольничномуЛисту.ДатаНачалаСобытия) - 1
	|			ТОГДА 0
	|		КОГДА ПервыйГодРасчета2011.Год <> ГОД(НачислениеПоБольничномуЛисту.ДатаНачалаСобытия) - 1
	|				И ВторойГодРасчета2011.Год <> ГОД(НачислениеПоБольничномуЛисту.ДатаНачалаСобытия) - 1
	|				И ПервыйГодРасчета2011.Год <> ГОД(НачислениеПоБольничномуЛисту.ДатаНачалаСобытия) - 2
	|				И ВторойГодРасчета2011.Год <> ГОД(НачислениеПоБольничномуЛисту.ДатаНачалаСобытия) - 2
	|			ТОГДА ГОД(НачислениеПоБольничномуЛисту.ДатаНачалаСобытия) - 1
	|		ИНАЧЕ 0
	|	КОНЕЦ КАК ЗамененныйВторойГодРасчета,
	|	ОсвобождениеОтРаботы1.ДатаНачала КАК ОсвобождениеС1,
	|	ОсвобождениеОтРаботы1.ДатаОкончания КАК ОсвобождениеПо1,
	|	ОсвобождениеОтРаботы1.ДолжностьВрача КАК ДолжностьВрача1,
	|	ОсвобождениеОтРаботы1.ФИОВрача КАК ФИОВрача1,
	|	ОсвобождениеОтРаботы2.ДатаНачала КАК ОсвобождениеС2,
	|	ОсвобождениеОтРаботы2.ДатаОкончания КАК ОсвобождениеПо2,
	|	ОсвобождениеОтРаботы2.ДолжностьВрача КАК ДолжностьВрача2,
	|	ОсвобождениеОтРаботы2.ФИОВрача КАК ФИОВрача2,
	|	ОсвобождениеОтРаботы3.ДатаНачала КАК ОсвобождениеС3,
	|	ОсвобождениеОтРаботы3.ДатаОкончания КАК ОсвобождениеПо3,
	|	ОсвобождениеОтРаботы3.ДолжностьВрача КАК ДолжностьВрача3,
	|	ОсвобождениеОтРаботы3.ФИОВрача КАК ФИОВрача3,
	|	ЗаработокПервыйГод.Заработок КАК ЗаработокПервыйГодРасчета,
	|	ЗаработокВторойГод.Заработок КАК ЗаработокВторойГодРасчета,
	|	Расчет2010.Результат КАК ЗаработокЗаПериодРасчета,
	|	НачислениеПоБольничномуЛисту.Дата КАК ДатаПредставленияПакетаДокументов,
	|	ВЫБОР
	|		КОГДА НачислениеПоБольничномуЛисту.Сотрудник.ВидЗанятости = ЗНАЧЕНИЕ(Перечисление.ВидыЗанятостиВОрганизации.Совместительство)
	|			ТОГДА ИСТИНА
	|		ИНАЧЕ ЛОЖЬ
	|	КОНЕЦ КАК Совместительство,
	|	ВЫБОР
	|		КОГДА НачислениеПоБольничномуЛисту.ПричинаНетрудоспособности = ЗНАЧЕНИЕ(Перечисление.ПричиныНетрудоспособности.ПоБеременностиИРодам)
	|			ТОГДА ЗНАЧЕНИЕ(Перечисление.ВидыПособийСоциальногоСтрахования.БеременностьРоды)
	|		ИНАЧЕ ЗНАЧЕНИЕ(Перечисление.ВидыПособийСоциальногоСтрахования.Нетрудоспособность)
	|	КОНЕЦ КАК ВидПособия,
	|	НачислениеПоБольничномуЛисту.ДатаНачалаСобытия КАК ДатаНачалаСобытия,
	|	НачислениеПоБольничномуЛисту.ДатаНачала,
	|	НачислениеПоБольничномуЛисту.ДатаОкончания,
	|	НачислениеПоБольничномуЛисту.СерияВходящегоДокумента,
	|	НачислениеПоБольничномуЛисту.ВидРасчета,
	|	ВЫБОР
	|		КОГДА ПервыйГодРасчета2011.Год = ГОД(НачислениеПоБольничномуЛисту.ДатаНачалаСобытия) - 2
	|				И ВторойГодРасчета2011.Год = ГОД(НачислениеПоБольничномуЛисту.ДатаНачалаСобытия) - 1
	|			ТОГДА ДАТАВРЕМЯ(1, 1, 1)
	|		ИНАЧЕ НачислениеПоБольничномуЛисту.Дата
	|	КОНЕЦ КАК ДатаЗаявленияОЗаменеРасчетногоГода,
	|	МРОТнаДатуСобытия.Размер КАК МРОТ,
	|	ДанныеСотрудника.ДоляВремени,
	|	НачислениеПоБольничномуЛисту.ГруппаИнвалидности,
	|	ВЫБОР
	|		КОГДА НачислениеПоБольничномуЛисту.ПричинаНетрудоспособности <> ЗНАЧЕНИЕ(Перечисление.ПричиныНетрудоспособности.ПоБеременностиИРодам)
	|				ИЛИ (НЕ НачислениеПоБольничномуЛисту.РасчетПоПравилам2010Года)
	|			ТОГДА ВЫБОР
	|					КОГДА ДанныеОСреднемЗаработке2011.Заработок > (ВЫРАЗИТЬ(ЕСТЬNULL(МРОТнаДатуСобытия.Размер, 0) * ВЫБОР
	|								КОГДА ЕСТЬNULL(ДанныеСотрудника.ДоляВремени, 0) = 0
	|									ТОГДА 1
	|								ИНАЧЕ ЕСТЬNULL(ДанныеСотрудника.ДоляВремени, 0)
	|							КОНЕЦ * 24 / 730 КАК ЧИСЛО(15, 2)))
	|						ТОГДА ДанныеОСреднемЗаработке2011.Заработок
	|					ИНАЧЕ ВЫРАЗИТЬ(ЕСТЬNULL(МРОТнаДатуСобытия.Размер, 0) * ВЫБОР
	|								КОГДА ЕСТЬNULL(ДанныеСотрудника.ДоляВремени, 0) = 0
	|									ТОГДА 1
	|								ИНАЧЕ ЕСТЬNULL(ДанныеСотрудника.ДоляВремени, 0)
	|							КОНЕЦ * 24 / 730 КАК ЧИСЛО(15, 2))
	|				КОНЕЦ
	|		КОГДА (НЕ НачислениеПоБольничномуЛисту.РасчетПособияИзТарифнойСтавки)
	|			ТОГДА ВЫБОР
	|					КОГДА ЕСТЬNULL(Расчет2010.ОтработаноДней, 0) = 0
	|						ТОГДА 0
	|					ИНАЧЕ Расчет2010.Результат / Расчет2010.ОтработаноДней
	|				КОНЕЦ
	|		ИНАЧЕ 0
	|	КОНЕЦ КАК СреднийДневнойЗаработок,
	|	ОсвобождениеОтРаботы1.ИдентификационныйНомерВрача КАК ИдентификационныйНомерВрача1,
	|	ОсвобождениеОтРаботы1.ФИОВрачаПредседателяВК КАК ФИОВрачаПредседателяВК1,
	|	ОсвобождениеОтРаботы2.ИдентификационныйНомерВрача КАК ИдентификационныйНомерВрача2,
	|	ОсвобождениеОтРаботы2.ФИОВрачаПредседателяВК КАК ФИОВрачаПредседателяВК2,
	|	ОсвобождениеОтРаботы3.ИдентификационныйНомерВрача КАК ИдентификационныйНомерВрача3,
	|	ОсвобождениеОтРаботы3.ФИОВрачаПредседателяВК КАК ФИОВрачаПредседателяВК3
	|ИЗ
	|	Документ.НачислениеПоБольничномуЛисту КАК НачислениеПоБольничномуЛисту
	|		ЛЕВОЕ СОЕДИНЕНИЕ ВТУходЗаБольнымЧленомСемьи КАК УходПервымЧленомСемьи
	|		ПО (УходПервымЧленомСемьи.НомерСтроки = 1)
	|			И НачислениеПоБольничномуЛисту.Ссылка = УходПервымЧленомСемьи.Ссылка
	|		ЛЕВОЕ СОЕДИНЕНИЕ ВТУходЗаБольнымЧленомСемьи КАК УходВторымЧленомСемьи
	|		ПО (УходВторымЧленомСемьи.НомерСтроки = 2)
	|			И НачислениеПоБольничномуЛисту.Ссылка = УходВторымЧленомСемьи.Ссылка
	|		ЛЕВОЕ СОЕДИНЕНИЕ ВТОсвобождениеОтРаботы КАК ОсвобождениеОтРаботы1
	|		ПО (ОсвобождениеОтРаботы1.НомерСтроки = 1)
	|			И НачислениеПоБольничномуЛисту.Ссылка = ОсвобождениеОтРаботы1.Ссылка
	|		ЛЕВОЕ СОЕДИНЕНИЕ ВТОсвобождениеОтРаботы КАК ОсвобождениеОтРаботы2
	|		ПО (ОсвобождениеОтРаботы2.НомерСтроки = 2)
	|			И НачислениеПоБольничномуЛисту.Ссылка = ОсвобождениеОтРаботы2.Ссылка
	|		ЛЕВОЕ СОЕДИНЕНИЕ ВТОсвобождениеОтРаботы КАК ОсвобождениеОтРаботы3
	|		ПО (ОсвобождениеОтРаботы3.НомерСтроки = 3)
	|			И НачислениеПоБольничномуЛисту.Ссылка = ОсвобождениеОтРаботы3.Ссылка
	|		ЛЕВОЕ СОЕДИНЕНИЕ ВТГоды2011 КАК ВторойГодРасчета2011
	|			ЛЕВОЕ СОЕДИНЕНИЕ ВТРасчет2011 КАК ЗаработокВторойГод
	|			ПО ВторойГодРасчета2011.Год = ЗаработокВторойГод.РасчетныйГод
	|				И ВторойГодРасчета2011.Ссылка = ЗаработокВторойГод.Ссылка
	|		ПО (ВторойГодРасчета2011.НомерСтроки = 2)
	|			И НачислениеПоБольничномуЛисту.Ссылка = ВторойГодРасчета2011.Ссылка
	|		ЛЕВОЕ СОЕДИНЕНИЕ ВТГоды2011 КАК ПервыйГодРасчета2011
	|			ЛЕВОЕ СОЕДИНЕНИЕ ВТРасчет2011 КАК ЗаработокПервыйГод
	|			ПО ПервыйГодРасчета2011.Год = ЗаработокПервыйГод.РасчетныйГод
	|				И ПервыйГодРасчета2011.Ссылка = ЗаработокПервыйГод.Ссылка
	|		ПО (ПервыйГодРасчета2011.НомерСтроки = 1)
	|			И НачислениеПоБольничномуЛисту.Ссылка = ПервыйГодРасчета2011.Ссылка
	|		ЛЕВОЕ СОЕДИНЕНИЕ ВТРасчет2010 КАК Расчет2010
	|		ПО НачислениеПоБольничномуЛисту.Ссылка = Расчет2010.Ссылка
	|		ЛЕВОЕ СОЕДИНЕНИЕ ВТДанныеСотрудника КАК ДанныеСотрудника
	|		ПО НачислениеПоБольничномуЛисту.Ссылка = ДанныеСотрудника.Ссылка
	|		ЛЕВОЕ СОЕДИНЕНИЕ ВТРазмерММОТНаДатуДатаНачалаСобытия КАК МРОТнаДатуСобытия
	|		ПО НачислениеПоБольничномуЛисту.ДатаНачала = МРОТнаДатуСобытия.ДатаНачалаСобытия
	|		ЛЕВОЕ СОЕДИНЕНИЕ ВТДанныеОСреднемЗаработке2011 КАК ДанныеОСреднемЗаработке2011
	|		ПО НачислениеПоБольничномуЛисту.Ссылка = ДанныеОСреднемЗаработке2011.Регистратор
	|ГДЕ
	|	НачислениеПоБольничномуЛисту.Ссылка В
	|			(ВЫБРАТЬ
	|				ДокументыЗаполнения.Ссылка
	|			ИЗ
	|				ВТДокументыЗаполнения КАК ДокументыЗаполнения)
	|
	|УПОРЯДОЧИТЬ ПО
	|	Фамилия,
	|	Имя,
	|	Отчество,
	|	Сотрудник,
	|	ДатаНачалаСобытия";
	
	Запрос.УстановитьПараметр("ДатаПередачиФССВыплатыПособий", ПроцедурыУправленияПерсоналом.ЗначениеУчетнойПолитикиПоПерсоналуОрганизации(глЗначениеПеременной("глУчетнаяПолитикаПоПерсоналуОрганизации"), Организация, "ДатаПередачиФССВыплатыПособий"));
	Запрос.УстановитьПараметр("Организация", Организация);
	Запрос.УстановитьПараметр("ТекущийРеестр", Ссылка);
	Запрос.УстановитьПараметр("ДатаЗакона213ФЗ",ПроведениеРасчетов.ДатаЗаменыЕСНСтраховымиВзносами());
	Запрос.УстановитьПараметр("ВидРасчета", ОбщегоНазначенияЗК.ОсобыйЭлемент(ПланыВидовРасчета.СреднийЗаработок, "ПоЗаработкуПособийС2011"));
	Запрос.УстановитьПараметр("ЗаполнятьВсемиДокументами", ТекущаяСтрока = Неопределено);
	Если ТекущаяСтрока <> Неопределено Тогда
		Запрос.УстановитьПараметр("Ссылка", ТекущаяСтрока.ЛистокНетрудоспособности);
	Иначе
		Запрос.УстановитьПараметр("Ссылка", Документы.НачислениеПоБольничномуЛисту.ПустаяСсылка());
	КонецЕсли;
	Если ТекущаяСтрока <> Неопределено Тогда
		Выборка = Запрос.Выполнить().Выбрать();
		Если Выборка.Следующий() Тогда
			ЗаполнитьЗначенияСвойств(ТекущаяСтрока, Выборка);
			ТекущаяСтрока.ИнаяПолезнаяИнформация = СформироватьИнаяПолезнаяИнформация(ТекущаяСтрока);
		КонецЕсли;
	Иначе
		РаботникиОрганизации.Загрузить(Запрос.Выполнить().Выгрузить());
		Для каждого СтрокаТЧ Из РаботникиОрганизации Цикл
			СтрокаТЧ.ИнаяПолезнаяИнформация = СформироватьИнаяПолезнаяИнформация(СтрокаТЧ);
		КонецЦикла;
	КонецЕсли;

КонецПроцедуры

#Если ТолстыйКлиентОбычноеПриложение Тогда

Процедура ВписатьВСтрокуКодУсловийИсчисления(СтрокаУсловий, КодУсловий)

	Если ЗначениеЗаполнено(КодУсловий) И Найти("43,44,45,47", КодУсловий) > 0 Тогда
		СтрокаУсловий = СтрокаУсловий + ?(ЗначениеЗаполнено(СтрокаУсловий),", ","") + КодУсловий
	КонецЕсли;

КонецПроцедуры

Функция ОписаниеСтажаВПечатнойФорме(СтажЛет, СтажМесяцев)

	Возврат ?(ЗначениеЗаполнено(СтажЛет), ", " + СтажЛет + " " + ОбщегоНазначения.ФормаМножественногоЧисла("год","года","лет", СтажЛет),"") + ?(ЗначениеЗаполнено(СтажМесяцев), Символы.ПС + СтажМесяцев + " " + ОбщегоНазначения.ФормаМножественногоЧисла("месяц","месяца","месяцев", СтажМесяцев),"");

КонецФункции // ОписаниеСтажаВПечатнойФорме()
	
// Печатает реестр сведений для назначения и выплаты пособий
//
// Параметры
//  нет
//
// Возвращаемое значение:
//   ТабличныйДокумент
//
Функция ПечатьОписьЗаявленийИДокументовВФСС()
	
	ОбработкаКомментариев = глЗначениеПеременной("глОбработкаСообщений");
	ОбработкаКомментариев.УдалитьСообщения();
		
	ВыборкаПоШапкеДокумента = ОбменСведениямиОПособияхСФСС.СформироватьЗапросПоШапкеДокумента(ЭтотОбъект).Выбрать();
	ВыборкаПоШапкеДокумента.Следующий();
	
	ВыборкаПоТЧРаботникиОрганизации = СформироватьЗапросПоТЧРаботникиОрганизации().Выбрать();
	
	Отказ = Ложь;
	
	ПроверитьПравильностьЗаполненияДокумента(Отказ, Ложь, ВыборкаПоШапкеДокумента, ВыборкаПоТЧРаботникиОрганизации);
	
	Если Отказ Тогда
	
		ОбработкаКомментариев.ПоказатьСообщения();
		Возврат Неопределено;
	
	КонецЕсли; 
	
	ВыборкаПоТЧРаботникиОрганизации.Сбросить();
	
	Возврат ОбменСведениямиОПособияхСФСС.ПечатьОписьЗаявленийИДокументовВФСС(ВыборкаПоШапкеДокумента, ВыборкаПоТЧРаботникиОрганизации);
		

КонецФункции // ПечатьРеестрСведенийВФСС()

// Печатает реестр сведений для назначения и выплаты пособий
//
// Параметры
//  нет
//
// Возвращаемое значение:
//   ТабличныйДокумент
//
Функция ПечатьРеестрСведенийВФСС()
	
	ОбработкаКомментариев = глЗначениеПеременной("глОбработкаСообщений");
	ОбработкаКомментариев.УдалитьСообщения();
		
	ВыборкаПоШапкеДокумента = ОбменСведениямиОПособияхСФСС.СформироватьЗапросПоШапкеДокумента(ЭтотОбъект).Выбрать();
	ВыборкаПоШапкеДокумента.Следующий();
	
	ВыборкаПоТЧРаботникиОрганизации = СформироватьЗапросПоТЧРаботникиОрганизации().Выбрать();
	
	Отказ = Ложь;

	ПроверитьПравильностьЗаполненияДокумента(Отказ, Ложь, ВыборкаПоШапкеДокумента, ВыборкаПоТЧРаботникиОрганизации);
	
	Если Отказ Тогда
	
		ОбработкаКомментариев.ПоказатьСообщения();
		Возврат Неопределено;
	
	КонецЕсли; 
	
	ВыборкаПоТЧРаботникиОрганизации.Сбросить();
	
	ТабДокумент = Новый ТабличныйДокумент;
		
	ТабДокумент.ИмяПараметровПечати = "ПАРАМЕТРЫ_ПЕЧАТИ_РеестрСведенийВФССОПособияхПоНетрудоспособности";
	ТабДокумент.ОриентацияСтраницы = ОриентацияСтраницы.Ландшафт;
	
	Макет = ПолучитьМакет("РеестрСведенийВФСС");
	
	ОбластьШапка = Макет.ПолучитьОбласть("Шапка");
	ОбластьСтрока = Макет.ПолучитьОбласть("Строка");
	ОбластьПодвал = Макет.ПолучитьОбласть("Подвал");
	ОбластьПодписи = Макет.ПолучитьОбласть("Подписи");
	ПовторятьПриПечатиСтроки = Макет.ПолучитьОбласть("ПовторятьПриПечати"); // повторяющаяся шапка страницы
	
	// массив с двумя строками - для разбиения на страницы
	ВыводимыеОбласти = Новый Массив();
	ВыводимыеОбласти.Добавить(ОбластьСтрока);
	
	ОбластьШапка.Параметры.Заполнить(ВыборкаПоШапкеДокумента);
	ОбластьПодписи.Параметры.Заполнить(ВыборкаПоШапкеДокумента);
	ТабДокумент.Вывести(ОбластьШапка);
	ТабДокумент.Вывести(ПовторятьПриПечатиСтроки);
	
	ВсегоСтрокДокумента = ВыборкаПоТЧРаботникиОрганизации.Количество();
	ВыведеноСтрок = 0;
	Пока ВыборкаПоТЧРаботникиОрганизации.Следующий() Цикл
		
		ОбластьСтрока.Параметры.Заполнить(ВыборкаПоТЧРаботникиОрганизации);
		
		ОбластьСтрока.Параметры.АдресРегистрации = УправлениеКонтактнойИнформацией.ПолучитьПредставлениеАдресаПоСтрока(ВыборкаПоТЧРаботникиОрганизации.АдресРегистрации);
		Если ВыборкаПоТЧРаботникиОрганизации.ПеречислятьПособиеПочтовымПереводом Тогда
			ОбластьСтрока.Параметры.АдресПочтовый = УправлениеКонтактнойИнформацией.ПолучитьПредставлениеАдресаПоСтрока(ВыборкаПоТЧРаботникиОрганизации.АдресПочтовый);
			ОбластьСтрока.Параметры.НаименованиеБанка = "-";
			ОбластьСтрока.Параметры.БИКБанка = "-";
			ОбластьСтрока.Параметры.НомерЛицевогоСчета = "-";
		Иначе
			ОбластьСтрока.Параметры.АдресПочтовый = "-";
		КонецЕсли;
		
		Если ВыборкаПоТЧРаботникиОрганизации.ВидПособия = Перечисления.ВидыПособийСоциальногоСтрахования.БеременностьРоды Тогда
			ОбластьСтрока.Параметры.СерияДокумента = "-";
			ОбластьСтрока.Параметры.НомерДокумента = "-";
			ОбластьСтрока.Параметры.ДатаВыдачиДокумента = "-";
			ОбластьСтрока.Параметры.ИНН = "-";
		КонецЕсли;
		
		Если Не ЗначениеЗаполнено(ОбластьСтрока.Параметры.ИнаяПолезнаяИнформация) Тогда
			ОбластьСтрока.Параметры.ИнаяПолезнаяИнформация = "-"
		КонецЕсли;
		
		Если Не ЗначениеЗаполнено(ОбластьСтрока.Параметры.ИНН) Тогда
			ОбластьСтрока.Параметры.ИНН = "-"
		КонецЕсли;
		
		Если ЗначениеЗаполнено(ВыборкаПоТЧРаботникиОрганизации.НомерПервичногоБольничного) Тогда
			ОбластьСтрока.Параметры.НомерВходящегоДокумента = СокрЛП(ВыборкаПоТЧРаботникиОрганизации.НомерВходящегоДокумента) + " (" + СокрЛП(ВыборкаПоТЧРаботникиОрганизации.НомерПервичногоБольничного) + ")";
		КонецЕсли;
		
		ОбластьСтрока.Параметры.ПричинаНетрудоспособности = ВыборкаПоТЧРаботникиОрганизации.КодПричиныНетрудоспособности
			+ ?(ЗначениеЗаполнено(ВыборкаПоТЧРаботникиОрганизации.ДополнительныйКодПричиныНетрудоспособности),", " + ВыборкаПоТЧРаботникиОрганизации.ДополнительныйКодПричиныНетрудоспособности,"")
			+ ?(ЗначениеЗаполнено(ВыборкаПоТЧРаботникиОрганизации.ВторойКодПричиныНетрудоспособности),", " + ВыборкаПоТЧРаботникиОрганизации.ВторойКодПричиныНетрудоспособности + " (" + Формат(ВыборкаПоТЧРаботникиОрганизации.ДатаИзмененияКодаПричиныНетрудоспособности,"ДФ=dd.MM.yyyy") + ")","");
			
		ОбластьСтрока.Параметры.УходЗаРодственником = ?(ЗначениеЗаполнено(ВыборкаПоТЧРаботникиОрганизации.УходЗаРодственникомФИО1),СокрЛП(ВыборкаПоТЧРаботникиОрганизации.УходЗаРодственникомФИО1) 
			+ ОписаниеСтажаВПечатнойФорме(ВыборкаПоТЧРаботникиОрганизации.УходЗаРодственникомЛет1, ВыборкаПоТЧРаботникиОрганизации.УходЗаРодственникомМесяцев1)
			+ ?(ЗначениеЗаполнено(ВыборкаПоТЧРаботникиОрганизации.УходЗаРодственникомРодственнаяСвязь1),", " + ВыборкаПоТЧРаботникиОрганизации.УходЗаРодственникомРодственнаяСвязь1, ""),"")
			+ ?(ЗначениеЗаполнено(ВыборкаПоТЧРаботникиОрганизации.УходЗаРодственникомФИО2), "; " + Символы.ПС + СокрЛП(ВыборкаПоТЧРаботникиОрганизации.УходЗаРодственникомФИО2) 
			+ ОписаниеСтажаВПечатнойФорме(ВыборкаПоТЧРаботникиОрганизации.УходЗаРодственникомЛет2, ВыборкаПоТЧРаботникиОрганизации.УходЗаРодственникомМесяцев2)
			+ ?(ЗначениеЗаполнено(ВыборкаПоТЧРаботникиОрганизации.УходЗаРодственникомРодственнаяСвязь2),", " + ВыборкаПоТЧРаботникиОрганизации.УходЗаРодственникомРодственнаяСвязь2, ""),"");
        Если Не ЗначениеЗаполнено(ОбластьСтрока.Параметры.УходЗаРодственником) Тогда
			ОбластьСтрока.Параметры.УходЗаРодственником = "-";
		КонецЕсли;
		
		Если ЗначениеЗаполнено(ВыборкаПоТЧРаботникиОрганизации.ПериодНахожденияВСтационареСРебенкомС) И ЗначениеЗаполнено(ВыборкаПоТЧРаботникиОрганизации.ПериодНахожденияВСтационареСРебенкомПо) Тогда
			ОбластьСтрока.Параметры.ПериодНахожденияВСтационареСРебенком = ОбменСведениямиОПособияхСФСС.ОписаниеПериодаВПечатнойФорме(ВыборкаПоТЧРаботникиОрганизации.ПериодНахожденияВСтационареСРебенкомС, ВыборкаПоТЧРаботникиОрганизации.ПериодНахожденияВСтационареСРебенкомПо);
		Иначе
			ОбластьСтрока.Параметры.ПериодНахожденияВСтационареСРебенком = "-";
		КонецЕсли;
		
		ОбластьСтрока.Параметры.Освобождение = ОбменСведениямиОПособияхСФСС.ОписаниеПериодаВПечатнойФорме(ВыборкаПоТЧРаботникиОрганизации.ОсвобождениеС1,Макс(ВыборкаПоТЧРаботникиОрганизации.ОсвобождениеПо1,ВыборкаПоТЧРаботникиОрганизации.ОсвобождениеПо2,ВыборкаПоТЧРаботникиОрганизации.ОсвобождениеПо3));
		
		Если ВыборкаПоТЧРаботникиОрганизации.ПоставленаНаУчетВРанниеСрокиБеременности Тогда
			ОбластьСтрока.Параметры.ПоставленаНаУчетВРанниеСрокиБеременности = "Да" + Символы.ПС + Формат(ВыборкаПоТЧРаботникиОрганизации.ДатаСправкиБеременной,"ДФ=dd.MM.yyyy")
		КонецЕсли;
		
		ОбластьСтрока.Параметры.Стаж = СтрЗаменить(ОписаниеСтажаВПечатнойФорме(ВыборкаПоТЧРаботникиОрганизации.СтажЛет, ВыборкаПоТЧРаботникиОрганизации.СтажМесяцев),",","");
		Если ВыборкаПоТЧРаботникиОрганизации.СтажЛет * 12 + ВыборкаПоТЧРаботникиОрганизации.СтажМесяцев > ВыборкаПоТЧРаботникиОрганизации.СтажБезНестраховыхПериодовЛет * 12 + ВыборкаПоТЧРаботникиОрганизации.СтажБезНестраховыхПериодовСтажМесяцев Тогда
			ЛетСтажа = Макс(ВыборкаПоТЧРаботникиОрганизации.СтажЛет - ВыборкаПоТЧРаботникиОрганизации.СтажБезНестраховыхПериодовЛет, 0);
			МесяцевСтажа = ВыборкаПоТЧРаботникиОрганизации.СтажМесяцев - ВыборкаПоТЧРаботникиОрганизации.СтажБезНестраховыхПериодовСтажМесяцев;
			Если МесяцевСтажа < 0 Тогда
				Если ЛетСтажа < 1 Тогда
					МесяцевСтажа = 0
				Иначе
					ЛетСтажа = ЛетСтажа - 1;
					МесяцевСтажа = МесяцевСтажа + 12;
				КонецЕсли;
			КонецЕсли;
			ОбластьСтрока.Параметры.НестраховыеПериоды = СтрЗаменить(ОписаниеСтажаВПечатнойФорме(ЛетСтажа, МесяцевСтажа),",","");
		Иначе 
			ОбластьСтрока.Параметры.НестраховыеПериоды = "";
		КонецЕсли;
		
		Если ЗначениеЗаполнено(ВыборкаПоТЧРаботникиОрганизации.СрочныйДоговорС) И ЗначениеЗаполнено(ВыборкаПоТЧРаботникиОрганизации.СрочныйДоговорПо) Тогда
			ОбластьСтрока.Параметры.СрочныйДоговор = ОбменСведениямиОПособияхСФСС.ОписаниеПериодаВПечатнойФорме(ВыборкаПоТЧРаботникиОрганизации.СрочныйДоговорС, ВыборкаПоТЧРаботникиОрганизации.СрочныйДоговорПо);
		Иначе
			ОбластьСтрока.Параметры.СрочныйДоговор = "-";
		КонецЕсли;
		
		УсловияИсчисления = "";
		ВписатьВСтрокуКодУсловийИсчисления(УсловияИсчисления, ВыборкаПоТЧРаботникиОрганизации.УсловияИсчисленияКод1);
		ВписатьВСтрокуКодУсловийИсчисления(УсловияИсчисления, ВыборкаПоТЧРаботникиОрганизации.УсловияИсчисленияКод2);
		ВписатьВСтрокуКодУсловийИсчисления(УсловияИсчисления, ВыборкаПоТЧРаботникиОрганизации.УсловияИсчисленияКод3);
		Если ЗначениеЗаполнено(УсловияИсчисления) Тогда
			ОбластьСтрока.Параметры.УсловияИсчисления = УсловияИсчисления;
		Иначе
			ОбластьСтрока.Параметры.УсловияИсчисления = "-";
		КонецЕсли;
		
		Если ЗначениеЗаполнено(ВыборкаПоТЧРаботникиОрганизации.КодНарушенияРежима) И ЗначениеЗаполнено(ВыборкаПоТЧРаботникиОрганизации.ДатаНарушенияРежима) Тогда
			ОбластьСтрока.Параметры.НарушениеРежима = ВыборкаПоТЧРаботникиОрганизации.КодНарушенияРежима + ", " + Формат(ВыборкаПоТЧРаботникиОрганизации.ДатаНарушенияРежима,"ДФ=dd.MM.yyyy") 
				+ ?(ЗначениеЗаполнено(ВыборкаПоТЧРаботникиОрганизации.УважительнаяПричинаНарушенияРежима)," (" + СокрЛП(ВыборкаПоТЧРаботникиОрганизации.УважительнаяПричинаНарушенияРежима) + ")","");
		Иначе
			ОбластьСтрока.Параметры.НарушениеРежима = "-";
		КонецЕсли;
		
		Если ВыборкаПоТЧРаботникиОрганизации.ПорядокРасчетаСреднегоЗаработка = 0 Тогда
			ОбластьСтрока.Параметры.ПериодРасчетаС = Формат(ВыборкаПоТЧРаботникиОрганизации.ПервыйГодРасчета,"ЧЦ=4; ЧГ=0") + ?(ЗначениеЗаполнено(ВыборкаПоТЧРаботникиОрганизации.ЗамененныйПервыйГодРасчета) И ВыборкаПоТЧРаботникиОрганизации.ПервыйГодРасчета <> ВыборкаПоТЧРаботникиОрганизации.ЗамененныйПервыйГодРасчета, " (" + Формат(ВыборкаПоТЧРаботникиОрганизации.ДатаЗаявленияОЗаменеРасчетногоГода,"ДФ=dd.MM.yyyy") + ")","");
			ОбластьСтрока.Параметры.ПериодРасчетаПо = Формат(ВыборкаПоТЧРаботникиОрганизации.ВторойГодРасчета,"ЧЦ=4; ЧГ=0") + ?(ЗначениеЗаполнено(ВыборкаПоТЧРаботникиОрганизации.ЗамененныйВторойГодРасчета) И ВыборкаПоТЧРаботникиОрганизации.ВторойГодРасчета <> ВыборкаПоТЧРаботникиОрганизации.ЗамененныйВторойГодРасчета, " (" + Формат(ВыборкаПоТЧРаботникиОрганизации.ДатаЗаявленияОЗаменеРасчетногоГода,"ДФ=dd.MM.yyyy") + ")","");
			
			ЗаработокПервыйГодРасчета = ВыборкаПоТЧРаботникиОрганизации.ЗаработокПервыйГодРасчета;
			ЗаработокВторойГодРасчета = ВыборкаПоТЧРаботникиОрганизации.ЗаработокВторойГодРасчета;
			Разница = ВыборкаПоТЧРаботникиОрганизации.СреднийДневнойЗаработок - (ЗаработокПервыйГодРасчета + ЗаработокВторойГодРасчета) / 730;
			Если Разница > -0.02 И Разница < 0.02 Тогда
				СреднийЗаработок = ЗаработокПервыйГодРасчета + ЗаработокВторойГодРасчета
			Иначе
				СреднийЗаработок = ВыборкаПоТЧРаботникиОрганизации.МРОТ
			КонецЕсли;
			ОбластьСтрока.Параметры.СреднийЗаработок = Формат(СреднийЗаработок,"ЧЦ=15; ЧДЦ=2; ЧГ=0");
		ИначеЕсли ВыборкаПоТЧРаботникиОрганизации.ПорядокРасчетаСреднегоЗаработка = 1 Тогда
			ОбластьСтрока.Параметры.ПериодРасчетаС = Формат(ВыборкаПоТЧРаботникиОрганизации.ПериодРасчетаСреднегоЗаработкаНачало,"ДФ=dd.MM.yyyy");
			ОбластьСтрока.Параметры.ПериодРасчетаПо = Формат(ВыборкаПоТЧРаботникиОрганизации.ПериодРасчетаСреднегоЗаработкаОкончание,"ДФ=dd.MM.yyyy");
			ОбластьСтрока.Параметры.СреднийЗаработок = Формат(ВыборкаПоТЧРаботникиОрганизации.ЗаработокЗаПериодРасчета,"ЧЦ=15; ЧДЦ=2; ЧГ=0") + " (" + Формат(ВыборкаПоТЧРаботникиОрганизации.КалендарныхДнейРасчетногоПериода,"ЧЦ=3; ЧГ=0") + ")";
		Иначе
			ОбластьСтрока.Параметры.ПериодРасчетаС = "-";
			ОбластьСтрока.Параметры.ПериодРасчетаПо = "-";
			Если ВыборкаПоТЧРаботникиОрганизации.ПорядокРасчетаСреднегоЗаработка = 2 Тогда
				ОбластьСтрока.Параметры.СреднийЗаработок = Формат(ВыборкаПоТЧРаботникиОрганизации.ТарифнаяСтавкаОклад,"ЧЦ=15; ЧДЦ=2; ЧГ=0");
			ИначеЕсли ВыборкаПоТЧРаботникиОрганизации.ПорядокРасчетаСреднегоЗаработка = 3 Тогда
				ОбластьСтрока.Параметры.СреднийЗаработок = Формат(ВыборкаПоТЧРаботникиОрганизации.МРОТ,"ЧЦ=15; ЧДЦ=2; ЧГ=0");
			Иначе
				ОбластьСтрока.Параметры.СреднийЗаработок = "";
			КонецЕсли;
		КонецЕсли;
		
		
		// разбиение на страницы
		ВыведеноСтрок = ВыведеноСтрок + 1;
		
		// Проверим, уместится ли строка на странице или надо открывать новую страницу
		ВывестиПодвалЛиста = Не ФормированиеПечатныхФорм.ПроверитьВыводТабличногоДокумента(ТабДокумент, ВыводимыеОбласти);
		Если Не ВывестиПодвалЛиста И ВыведеноСтрок = ВсегоСтрокДокумента Тогда
			ВыводимыеОбласти.Добавить(ОбластьПодвал);
			Если ВыводитьПодписиВРеестрПособий Тогда
				ВыводимыеОбласти.Добавить(ОбластьПодписи);
			КонецЕсли;
			ВывестиПодвалЛиста = Не ФормированиеПечатныхФорм.ПроверитьВыводТабличногоДокумента(ТабДокумент, ВыводимыеОбласти);
		КонецЕсли;
		Если ВывестиПодвалЛиста Тогда
			ТабДокумент.ВывестиГоризонтальныйРазделительСтраниц();
			ТабДокумент.Вывести(ПовторятьПриПечатиСтроки);
		КонецЕсли;
		
		ТабДокумент.Вывести(ОбластьСтрока);
	
	КонецЦикла; 
	
	ТабДокумент.Вывести(ОбластьПодвал);
	Если ВыводитьПодписиВРеестрПособий Тогда
		ТабДокумент.Вывести(ОбластьПодписи);
	КонецЕсли;
	
	Возврат ТабДокумент;

КонецФункции // ПечатьРеестрСведенийВФСС()

////////////////////////////////////////////////////////////////////////////////
// ЭКСПОРТНЫЕ ПРОЦЕДУРЫ И ФУНКЦИИ

//Процедура вывода сведений на печать
Функция Печать(ИмяМакета, КоличествоЭкземпляров = 1, НаПринтер = Ложь) Экспорт
	
	Если ИмяМакета = "ОписьЗаявленийИДокументовВФСС" Тогда
		
		ТабДокумент = Новый ТабличныйДокумент;
		
		ТабДокумент = ПечатьОписьЗаявленийИДокументовВФСС();
		
		Возврат УниверсальныеМеханизмы.НапечататьДокумент(ТабДокумент, КоличествоЭкземпляров, НаПринтер, "Опись заявлений и документов в ФСС");
		
	ИначеЕсли ИмяМакета = "РеестрСведенийВФСС" Тогда
		
		ТабДокумент = ПечатьРеестрСведенийВФСС();
		
		Возврат УниверсальныеМеханизмы.НапечататьДокумент(ТабДокумент, КоличествоЭкземпляров, НаПринтер, "Реестр сведений в ФСС",,ТабДокумент);
		
	КонецЕсли;
	
КонецФункции // Печать() 
 
#КонецЕсли

Процедура Автозаполнение(Режим = Неопределено, ТекущаяСтрока = Неопределено) Экспорт
	
	Если Режим = "ДанныеСотрудника" Тогда
		ЗаполнитьДанныеСотрудника(ТекущаяСтрока)
	ИначеЕсли Режим = "ДанныеБольничного" Тогда	
		ТекущийСотрудник = ТекущаяСтрока.Сотрудник;
		ЗаполнитьДанныеБольничного(ТекущаяСтрока);
		Если ТекущийСотрудник <> ТекущаяСтрока.Сотрудник Тогда
			ЗаполнитьДанныеСотрудника(ТекущаяСтрока)
		КонецЕсли;
	Иначе	
		ЗаполнитьДанныеБольничного();
		ЗаполнитьДанныеСотрудника();
	КонецЕсли;
	
КонецПроцедуры

Процедура ПроверитьПравильностьЗаполненияДокумента(ЕстьОшибки, СообщатьОбУспехе = Истина, ВыборкаПоШапкеДокумента = Неопределено, ВыборкаПоРаботникиОрганизации = Неопределено) Экспорт
	
	// Заголовок для сообщений об ошибках проведения.
	Заголовок = ttk_ОбщегоНазначения.ПредставлениеДокументаПриПроведении(Ссылка);

	Обработка = глЗначениеПеременной("глОбработкаСообщений");
	СообщенияРазделПроверки = Обработка.ДобавитьСообщение(Заголовок, Перечисления.ВидыСообщений.Информация);

	Если ВыборкаПоШапкеДокумента = Неопределено Тогда
		ВыборкаПоШапкеДокумента = ОбменСведениямиОПособияхСФСС.СформироватьЗапросПоШапкеДокумента(ЭтотОбъект).Выбрать();
		ВыборкаПоШапкеДокумента.Следующий();
	КонецЕсли;
	Если ВыборкаПоРаботникиОрганизации = Неопределено Тогда
		ВыборкаПоРаботникиОрганизации = СформироватьЗапросПоТЧРаботникиОрганизации().Выбрать();
	КонецЕсли;
	
	Отказ = Ложь;
	
	ОбменСведениямиОПособияхСФСС.ПроверитьДанныеСтрахователя(ВыборкаПоШапкеДокумента, Отказ, Заголовок);
	
	Пока ВыборкаПоРаботникиОрганизации.Следующий() Цикл
		
		ПроверитьЗаполнениеСтрокиТЧРаботникиОрганизации(ВыборкаПоРаботникиОрганизации, Отказ, Заголовок);
		
	КонецЦикла; 
	
	Если Отказ тогда
		ЕстьОшибки = Истина;
	КонецЕсли;	 
	
	Если СообщатьОбУспехе И Не ЕстьОшибки Тогда
		Обработка.ДобавитьСообщение("Ошибок не обнаружено.", Перечисления.ВидыСообщений.Информация, , СообщенияРазделПроверки);		
	КонецЕсли;
	
КонецПроцедуры // ПроверитьПравильностьЗаполненияДокумента()

// Возвращает доступные варианты печати документа
//
// Возвращаемое значение:
//  Структура, каждая строка которой соответствует одному из вариантов печати
//
Функция ПолучитьСтруктуруПечатныхФорм() Экспорт
	
	//Возврат Новый Структура("РеестрСведенийВФСС", "Реестр сведений");
	Возврат Новый Структура("ОписьЗаявленийИДокументовВФСС, РеестрСведенийВФСС", "Опись заявлений и документов", "Реестр сведений");
	
КонецФункции // ПолучитьСтруктуруПечатныхФорм()

// Формирует файл, который можно будет записать на дискетку
//
// Параметры: 
//  Нет
//
// Возвращаемое значение:
//  Строка - содержимое файла
//
Функция СформироватьВыходнойФайл(Отказ, ПроверятьДанные = Истина, ВыборкаПоШапкеДокумента = Неопределено, ВыборкаПоРаботникиОрганизации = Неопределено) Экспорт

	Возврат	ОбменСведениямиОПособияхСФСС.СформироватьФайлРеестра(ЭтотОбъект, Отказ, ПроверятьДанные, ВыборкаПоШапкеДокумента, ВыборкаПоРаботникиОрганизации)
	
КонецФункции // СформироватьВыходнойФайл()

Функция СформироватьИнаяПолезнаяИнформация(ТекущаяСтрока) Экспорт
	
	ИнаяПолезнаяИнформация = "";
	
	Если ЗначениеЗаполнено(ТекущаяСтрока.ПериодПростояС) И ЗначениеЗаполнено(ТекущаяСтрока.ПериодПростояПо) Тогда
		ИнаяПолезнаяИнформация = "Период простоя с " + Формат(ТекущаяСтрока.ПериодПростояС, "ДФ=dd.MM.yyyy") + " по " + Формат(ТекущаяСтрока.ПериодПростояПо, "ДФ=dd.MM.yyyy");
	КонецЕсли; 
	
	Если ТекущаяСтрока.ПорядокРасчетаСреднегоЗаработка = 0 И ЗначениеЗаполнено(ТекущаяСтрока.ДатаЗаявленияОЗаменеРасчетногоГода) Тогда
		ИнаяПолезнаяИнформация = ИнаяПолезнаяИнформация + ?(ПустаяСтрока(ИнаяПолезнаяИнформация), "", ". ") + "Заявление о замене календарных годов от " + Формат(ТекущаяСтрока.ДатаЗаявленияОЗаменеРасчетногоГода, "ДФ=dd.MM.yyyy");
	ИначеЕсли ТекущаяСтрока.ПорядокРасчетаСреднегоЗаработка = 1 Тогда
		ИнаяПолезнаяИнформация = ИнаяПолезнаяИнформация + ?(ПустаяСтрока(ИнаяПолезнаяИнформация), "", ". ") + "Заявление о расчете пособия по беременности и родам по нормам 2010 года от ___.___.______";
	КонецЕсли; 
	
	Если ТекущаяСтрока.РайонныйКоэффициент > 1 И ЗначениеЗаполнено(ТекущаяСтрока.Район) Тогда
		ИнаяПолезнаяИнформация = ИнаяПолезнаяИнформация + ?(ПустаяСтрока(ИнаяПолезнаяИнформация), "", ". ") + "Раионый коэффициент " + Формат(ТекущаяСтрока.РайонныйКоэффициент, "ЧДЦ=2") + ", район " + ТекущаяСтрока.Район;
	КонецЕсли;
	
	Если ТекущаяСтрока.ДоляВремени > 0 И ТекущаяСтрока.ДоляВремени < 1 Тогда
		ИнаяПолезнаяИнформация = ИнаяПолезнаяИнформация + ?(ПустаяСтрока(ИнаяПолезнаяИнформация), "", ". ") + "Застрахованное лицо на момент наступления страхового случая занято на условиях неполного рабочего времени с коэффициентом " + ТекущаяСтрока.ДоляВремени;
	КонецЕсли;
	
	Возврат ИнаяПолезнаяИнформация + ?(ПустаяСтрока(ИнаяПолезнаяИнформация), "", ". ");

КонецФункции // СформироватьСписокДокументовОснования()

////////////////////////////////////////////////////////////////////////////////
// ПРОЦЕДУРЫ И ФУНКЦИИ ДЛЯ ОБЕСПЕЧЕНИЯ ПРОВЕДЕНИЯ ДОКУМЕНТА


// Запрос по табличной части РаботникиОрганизации для вывода на печать и проверки корректности заполнения
//
// Параметры
//  <Параметр1>  - <Тип.Вид> - <описание параметра>
//                 <продолжение описания параметра>
//  <Параметр2>  - <Тип.Вид> - <описание параметра>
//                 <продолжение описания параметра>
//
// Возвращаемое значение:
//   <Тип.Вид>   - <описание возвращаемого значения>
//
Функция СформироватьЗапросПоТЧРаботникиОрганизации() Экспорт
	
	Запрос = Новый Запрос();
	Запрос.Текст = 
	"ВЫБРАТЬ
	|	ГОД(ПредельнаяВеличинаБазыСтраховыхВзносов.Период) КАК Год,
	|	ПредельнаяВеличинаБазыСтраховыхВзносов.Размер
	|ПОМЕСТИТЬ ВТПредельныеВеличиныПоГодам
	|ИЗ
	|	РегистрСведений.ПредельнаяВеличинаБазыСтраховыхВзносов КАК ПредельнаяВеличинаБазыСтраховыхВзносов
	|;
	|
	|////////////////////////////////////////////////////////////////////////////////
	|ВЫБРАТЬ
	|	Пособия.Фамилия + "" "" + Пособия.Имя + "" "" + Пособия.Отчество КАК ФИОСотрудника,
	|	Пособия.Ссылка,
	|	Пособия.НомерСтроки КАК НомерСтроки,
	|	Пособия.Сотрудник,
	|	Пособия.ФизЛицо,
	|	Пособия.ЛистокНетрудоспособности,
	|	Пособия.ИнаяПолезнаяИнформация,
	|	Пособия.КоличествоСтраниц,
	|	Пособия.ПеречислятьПособиеПочтовымПереводом,
	|	Пособия.НаименованиеБанка,
	|	Пособия.БИКБанка,
	|	Пособия.НомерЛицевогоСчета,
	|	Пособия.АдресРегистрации,
	|	Пособия.АдресПочтовый,
	|	Пособия.ДатаВыходаНаРаботу,
	|	Пособия.УстановленаИзмененаГруппаИнвалидности,
	|	Пособия.ДатаРегистрацииДокументовМСЭ,
	|	Пособия.КодНарушенияРежима,
	|	Пособия.ПериодНахожденияВСтационареСРебенкомПо,
	|	Пособия.ПериодНахожденияВСтационареСРебенкомС,
	|	Пособия.ДатаСправкиБеременной,
	|	Пособия.ДатаИзмененияКодаПричиныНетрудоспособности,
	|	Пособия.ВторойКодПричиныНетрудоспособности,
	|	Пособия.ДополнительныйКодПричиныНетрудоспособности,
	|	Пособия.КодПричиныНетрудоспособности,
	|	Пособия.ПоставленаНаУчетВРанниеСрокиБеременности,
	|	Пособия.ПериодПростояПо,
	|	Пособия.ПериодПростояС,
	|	Пособия.ДатаДействияДокумента,
	|	Пособия.ДатаВыдачиДокумента КАК ДатаВыдачиДокумента,
	|	Пособия.НомерДокумента КАК НомерДокумента,
	|	Пособия.СерияДокумента КАК СерияДокумента,
	|	Пособия.ВидДокумента,
	|	Пособия.Отчество,
	|	Пособия.Имя,
	|	Пособия.Фамилия,
	|	Пособия.СтажБезНестраховыхПериодовСтажМесяцев,
	|	Пособия.СтажБезНестраховыхПериодовЛет,
	|	Пособия.СтажМесяцев,
	|	Пособия.СтажЛет,
	|	Пособия.УсловияИсчисленияКод3,
	|	Пособия.УсловияИсчисленияКод2,
	|	Пособия.УсловияИсчисленияКод1,
	|	Пособия.ПорядокРасчетаСреднегоЗаработка,
	|	Пособия.ИНН,
	|	Пособия.СтраховойНомерПФР,
	|	Пособия.НомерВходящегоДокумента,
	|	Пособия.ДатаВыдачиБольничного,
	|	Пособия.НомерПервичногоБольничного,
	|	Пособия.ДатаОкончанияОплаты,
	|	Пособия.УважительнаяПричинаНарушенияРежима,
	|	Пособия.ДатаНарушенияРежима,
	|	Пособия.ДатаНачалаОплаты,
	|	Пособия.ПервыйГодРасчета,
	|	Пособия.ВторойГодРасчета,
	|	Пособия.КемВыданДокумент,
	|	Пособия.ДатаНовыйСтатусНетрудопособного,
	|	Пособия.НовыйСтатусНетрудопособного,
	|	Пособия.ДатаОсвидетельствованияМСЭ,
	|	Пособия.ДатаНаправленияВБюроМСЭ,
	|	Пособия.НомерЛисткаПродолжения,
	|	Пособия.ОГРН_Санатория,
	|	Пособия.НомерПутевки,
	|	Пособия.ДатаОкончанияПутевки,
	|	Пособия.НомерЛисткаПоОсновномуМестуРаботы,
	|	Пособия.ОГРН_ЛПУ,
	|	Пособия.НаименованиеЛПУ,
	|	Пособия.АдресЛПУ,
	|	Пособия.ЯвляетсяДубликатом,
	|	Пособия.Банк,
	|	Пособия.Пол,
	|	Пособия.ДатаРождения,
	|	Пособия.РайонныйКоэффициент,
	|	Пособия.ПериодРасчетаСреднегоЗаработкаНачало,
	|	Пособия.ПериодРасчетаСреднегоЗаработкаОкончание,
	|	Пособия.КалендарныхДнейРасчетногоПериода,
	|	Пособия.УходЗаРодственникомЛет1,
	|	Пособия.УходЗаРодственникомЛет2,
	|	Пособия.УходЗаРодственникомМесяцев1,
	|	Пособия.УходЗаРодственникомМесяцев2,
	|	Пособия.ЗамененныйПервыйГодРасчета,
	|	Пособия.ЗамененныйВторойГодРасчета,
	|	Пособия.ОсвобождениеС1,
	|	Пособия.ОсвобождениеС2,
	|	Пособия.ОсвобождениеС3,
	|	Пособия.ОсвобождениеПо1,
	|	Пособия.ОсвобождениеПо2,
	|	Пособия.ОсвобождениеПо3,
	|	Пособия.ДолжностьВрача1,
	|	Пособия.ДолжностьВрача2,
	|	Пособия.ДолжностьВрача3,
	|	Пособия.ФИОВрача1,
	|	Пособия.ФИОВрача2,
	|	Пособия.ФИОВрача3,
	|	Пособия.УходЗаРодственникомФИО1,
	|	Пособия.УходЗаРодственникомФИО2,
	|	Пособия.УходЗаРодственникомРодственнаяСвязь1,
	|	Пособия.УходЗаРодственникомРодственнаяСвязь2,
	|	Пособия.Район,
	|	ВЫБОР
	|		КОГДА Пособия.ЗаработокПервыйГодРасчета > ПредельнаяВеличинаЗаПервыйГодРасчета.Размер
	|			ТОГДА ПредельнаяВеличинаЗаПервыйГодРасчета.Размер
	|		ИНАЧЕ Пособия.ЗаработокПервыйГодРасчета
	|	КОНЕЦ КАК ЗаработокПервыйГодРасчета,
	|	ВЫБОР
	|		КОГДА Пособия.ЗаработокВторойГодРасчета > ПредельнаяВеличинаЗаВторойГодРасчета.Размер
	|			ТОГДА ПредельнаяВеличинаЗаВторойГодРасчета.Размер
	|		ИНАЧЕ Пособия.ЗаработокВторойГодРасчета
	|	КОНЕЦ КАК ЗаработокВторойГодРасчета,
	|	Пособия.ЗаработокЗаПериодРасчета,
	|	Пособия.ТарифнаяСтавкаОклад,
	|	Пособия.ДатаПредставленияПакетаДокументов,
	|	Пособия.ДатаЗаявленияОЗаменеРасчетногоГода,
	|	ВЫБОР
	|		КОГДА Пособия.ВидПособия = ЗНАЧЕНИЕ(Перечисление.ВидыПособийСоциальногоСтрахования.БеременностьРоды)
	|			ТОГДА ""2""
	|		ИНАЧЕ ""1""
	|	КОНЕЦ КАК ВидВыплаты,
	|	Пособия.ВидПособия,
	|	Пособия.Совместительство,
	|	Пособия.СреднийДневнойЗаработок,
	|	Пособия.МРОТ,
	|	Пособия.ДоляВремени,
	|	Пособия.СрочныйДоговорС,
	|	Пособия.СрочныйДоговорПо,
	|	Пособия.УходЗаРодственникомИспользованоДней1,
	|	Пособия.УходЗаРодственникомИспользованоДней2,
	|	""Заявление о выплате пособия, Листок нетруд-ти № "" + Пособия.НомерВходящегоДокумента КАК ДокументыОснования,
	|	Пособия.ВидДокумента.КодИМНС КАК ВидУдостоверенияЛичности,
	|	Пособия.ГруппаИнвалидности,
	|	Пособия.СтатусНалогоплательщика КАК СтатусНалогоплательщикаДляПроверки,
	|	ВЫБОР
	|		КОГДА Пособия.СтатусНалогоплательщика = ЗНАЧЕНИЕ(Перечисление.СтатусыНалогоплательщиковПоНДФЛ.НеРезидент)
	|			ТОГДА 0
	|		ИНАЧЕ 1
	|	КОНЕЦ КАК СтатусНалогоплательщика,
	|	Пособия.ИдентификационныйНомерВрача1,
	|	Пособия.ИдентификационныйНомерВрача2,
	|	Пособия.ИдентификационныйНомерВрача3,
	|	Пособия.ФИОВрачаПредседателяВК1,
	|	Пособия.ФИОВрачаПредседателяВК2,
	|	Пособия.ФИОВрачаПредседателяВК3
	|ИЗ
	|	Документ.РеестрСведенийВФССОПособияхПоНетрудоспособности.РаботникиОрганизации КАК Пособия
	|		ЛЕВОЕ СОЕДИНЕНИЕ ВТПредельныеВеличиныПоГодам КАК ПредельнаяВеличинаЗаПервыйГодРасчета
	|		ПО (ВЫБОР
	|				КОГДА Пособия.ПервыйГодРасчета < 2010
	|					ТОГДА 2010
	|				ИНАЧЕ Пособия.ПервыйГодРасчета
	|			КОНЕЦ = ПредельнаяВеличинаЗаПервыйГодРасчета.Год)
	|		ЛЕВОЕ СОЕДИНЕНИЕ ВТПредельныеВеличиныПоГодам КАК ПредельнаяВеличинаЗаВторойГодРасчета
	|		ПО (ВЫБОР
	|				КОГДА Пособия.ВторойГодРасчета < 2010
	|					ТОГДА 2010
	|				ИНАЧЕ Пособия.ВторойГодРасчета
	|			КОНЕЦ = ПредельнаяВеличинаЗаВторойГодРасчета.Год)
	|ГДЕ
	|	Пособия.Ссылка = &ДокументСсылка
	|
	|УПОРЯДОЧИТЬ ПО
	|	НомерСтроки";
	
	Запрос.УстановитьПараметр("ДокументСсылка", Ссылка);
	Запрос.УстановитьПараметр("Дата", Дата);
	
	Возврат Запрос.Выполнить();

КонецФункции // СформироватьЗапросПоТЧРаботникиОрганизации()
 
// Проверяет заполненность полей табличной части "РаботникиОрганизации"
// Проверка ведется по строке выборки по табличной части
//
// Параметры
// Параметры: 
//	СтрокаВыборкиПоТЧРаботникиОрганизации	- выборка из результата запрос
//	Отказ 									- флаг отказа
//	Заголовок								- Заголовок для сообщений об ошибках
//
Процедура ПроверитьЗаполнениеСтрокиТЧРаботникиОрганизации(ВыборкаПоСтрокамДокумента, Отказ, Заголовок)

	ТекстОшибкиСНомеромСтроки = НСтр("ru='В строке номер %НомерСтроки% табличной части ""Пособия"": '");
	ТекстОшибкиСНомеромСтроки = СтрЗаменить(ТекстОшибкиСНомеромСтроки, "%НомерСтроки%", ВыборкаПоСтрокамДокумента.НомерСтроки);
	
	ОбменСведениямиОПособияхСФСС.ПроверитьДанныеЗастрахованного(ВыборкаПоСтрокамДокумента, Отказ, Заголовок, ТекстОшибкиСНомеромСтроки);
	
	Если Не ЗначениеЗаполнено(ВыборкаПоСтрокамДокумента.ВидПособия) Тогда
		ОбщегоНазначения.ВывестиИнформациюОбОшибке(ТекстОшибкиСНомеромСтроки + "Не указан вид пособия!", Отказ, Заголовок);
	КонецЕсли;
	
	
КонецПроцедуры // ПроверитьЗаполнениеСтрокиТЧРаботникиОрганизации()

////////////////////////////////////////////////////////////////////////////////
// ОБРАБОТЧИКИ СОБЫТИЙ

Процедура ОбработкаПроведения(Отказ, РежимПроведения)

	ОбработкаКомментариев = глЗначениеПеременной("глОбработкаСообщений");
	ОбработкаКомментариев.УдалитьСообщения();
	
	Для Каждого Набор Из Движения Цикл
		Набор.Очистить();
	КонецЦикла;
	
	ВыборкаПоШапкеДокумента = ОбменСведениямиОПособияхСФСС.СформироватьЗапросПоШапкеДокумента(ЭтотОбъект).Выбрать();
	ВыборкаПоШапкеДокумента.Следующий();
	
	ВыборкаПоРаботникиОрганизации = СформироватьЗапросПоТЧРаботникиОрганизации().Выбрать();
	ПроверитьПравильностьЗаполненияДокумента(Отказ, Ложь, ВыборкаПоШапкеДокумента, ВыборкаПоРаботникиОрганизации);
	
	Если Отказ тогда
		ОбработкаКомментариев.ПоказатьСообщения();
		Возврат;
	КонецЕсли;
	
	//При проведении файл формируем заново 
	ВыборкаПоРаботникиОрганизации.Сбросить();
	ТекстФайла = СформироватьВыходнойФайл(Отказ, Ложь, ВыборкаПоШапкеДокумента, ВыборкаПоРаботникиОрганизации);

	//Сохраним сформированный файл сведений в регистре сведений
	Запись = Движения.АрхивДанныхРегламентированнойОтчетности.Добавить();
	Запись.Объект = Ссылка;
	Запись.ОписаниеДанных = "Реестр пособий по нетрудоспособности";
	Запись.Данные = ТекстФайла;

КонецПроцедуры

Процедура ПередЗаписью(Отказ, РежимЗаписи, РежимПроведения)
	
	МассивТЧ = Новый Массив();
	МассивТЧ.Добавить(РаботникиОрганизации);
	
	КраткийСоставДокумента = ПроцедурыУправленияПерсоналом.ЗаполнитьКраткийСоставДокумента(МассивТЧ, "Сотрудник");

КонецПроцедуры

Процедура ОбработкаУдаленияПроведения(Отказ)
	Для Каждого Набор Из Движения Цикл
		Набор.Очистить();
		Набор.Записать();
	КонецЦикла
КонецПроцедуры
