
Функция ПолучитьТаблицуПоказателейПоПлану(Ссылка) Экспорт
	
	Запрос = Новый Запрос(
	"ВЫБРАТЬ РАЗРЕШЕННЫЕ
	|	абс_ЗначенияПоказателейДляРасчетаКПЭ.Показатель,
	|	абс_ЗначенияПоказателейДляРасчетаКПЭ.НомерКорректировки,
	|	абс_ЗначенияПоказателейДляРасчетаКПЭ.ВидАналитикиКПЭ,
	|	абс_ЗначенияПоказателейДляРасчетаКПЭ.Подразделение,
	|	абс_ЗначенияПоказателейДляРасчетаКПЭ.Должность,
	|	абс_ЗначенияПоказателейДляРасчетаКПЭ.Сотрудник,
	|	абс_ЗначенияПоказателейДляРасчетаКПЭ.ЗначениеПоказателя
	|ПОМЕСТИТЬ ВТ_ЗначенияПлана
	|ИЗ
	|	РегистрСведений.абс_ЗначенияПоказателейДляРасчетаКПЭ КАК абс_ЗначенияПоказателейДляРасчетаКПЭ
	|ГДЕ
	|	абс_ЗначенияПоказателейДляРасчетаКПЭ.ВидОперации В (ЗНАЧЕНИЕ(Перечисление.абс_ВидыОперацийВводаЗначенийПоказателейДляРасчетаКПЭ.ПлановыеЗначения), ЗНАЧЕНИЕ(Перечисление.абс_ВидыОперацийВводаЗначенийПоказателейДляРасчетаКПЭ.КорректировкаПлановыхЗначений))
	|	И абс_ЗначенияПоказателейДляРасчетаКПЭ.ВидПремии = &ВидПремии
	|	И абс_ЗначенияПоказателейДляРасчетаКПЭ.Показатель = &Показатель
	|	И абс_ЗначенияПоказателейДляРасчетаКПЭ.Организация = &Организация
	|	И НАЧАЛОПЕРИОДА(абс_ЗначенияПоказателейДляРасчетаКПЭ.Период, ГОД) = НАЧАЛОПЕРИОДА(&Период, ГОД)
	|
	|СГРУППИРОВАТЬ ПО
	|	абс_ЗначенияПоказателейДляРасчетаКПЭ.Показатель,
	|	абс_ЗначенияПоказателейДляРасчетаКПЭ.ВидАналитикиКПЭ,
	|	абс_ЗначенияПоказателейДляРасчетаКПЭ.Подразделение,
	|	абс_ЗначенияПоказателейДляРасчетаКПЭ.Должность,
	|	абс_ЗначенияПоказателейДляРасчетаКПЭ.Сотрудник,
	|	абс_ЗначенияПоказателейДляРасчетаКПЭ.НомерКорректировки,
	|	абс_ЗначенияПоказателейДляРасчетаКПЭ.ЗначениеПоказателя
	|;
	|
	|////////////////////////////////////////////////////////////////////////////////
	|ВЫБРАТЬ
	|	ТаблицаКорректировокПлана.Показатель,
	|	ТаблицаКорректировокПлана.ВидАналитикиКПЭ,
	|	ТаблицаКорректировокПлана.Подразделение,
	|	ТаблицаКорректировокПлана.Должность,
	|	ТаблицаКорректировокПлана.Сотрудник,
	|	ВТ_ЗначенияПлана.ЗначениеПоказателя КАК ЗначениеПоказателя
	|ПОМЕСТИТЬ ВТ_ЗначенияПланаСКорректировками
	|ИЗ
	|	(ВЫБРАТЬ
	|		ВТ_ЗначенияПлана.Показатель КАК Показатель,
	|		МАКСИМУМ(ВТ_ЗначенияПлана.НомерКорректировки) КАК НомерКорректировки,
	|		ВТ_ЗначенияПлана.ВидАналитикиКПЭ КАК ВидАналитикиКПЭ,
	|		ВТ_ЗначенияПлана.Подразделение КАК Подразделение,
	|		ВТ_ЗначенияПлана.Должность КАК Должность,
	|		ВТ_ЗначенияПлана.Сотрудник КАК Сотрудник
	|	ИЗ
	|		ВТ_ЗначенияПлана КАК ВТ_ЗначенияПлана
	|	
	|	СГРУППИРОВАТЬ ПО
	|		ВТ_ЗначенияПлана.Должность,
	|		ВТ_ЗначенияПлана.Сотрудник,
	|		ВТ_ЗначенияПлана.Подразделение,
	|		ВТ_ЗначенияПлана.ВидАналитикиКПЭ,
	|		ВТ_ЗначенияПлана.Показатель) КАК ТаблицаКорректировокПлана
	|		ЛЕВОЕ СОЕДИНЕНИЕ ВТ_ЗначенияПлана КАК ВТ_ЗначенияПлана
	|		ПО ТаблицаКорректировокПлана.Показатель = ВТ_ЗначенияПлана.Показатель
	|			И ТаблицаКорректировокПлана.НомерКорректировки = ВТ_ЗначенияПлана.НомерКорректировки
	|			И ТаблицаКорректировокПлана.ВидАналитикиКПЭ = ВТ_ЗначенияПлана.ВидАналитикиКПЭ
	|			И ТаблицаКорректировокПлана.Подразделение = ВТ_ЗначенияПлана.Подразделение
	|			И ТаблицаКорректировокПлана.Должность = ВТ_ЗначенияПлана.Должность
	|			И ТаблицаКорректировокПлана.Сотрудник = ВТ_ЗначенияПлана.Сотрудник
	|;
	|
	|////////////////////////////////////////////////////////////////////////////////
	|ВЫБРАТЬ РАЗРЕШЕННЫЕ
	|	абс_ЗначенияПоказателейДляРасчетаКПЭ.Показатель,
	|	абс_ЗначенияПоказателейДляРасчетаКПЭ.НомерКорректировки,
	|	абс_ЗначенияПоказателейДляРасчетаКПЭ.ВидАналитикиКПЭ,
	|	абс_ЗначенияПоказателейДляРасчетаКПЭ.Подразделение,
	|	абс_ЗначенияПоказателейДляРасчетаКПЭ.Должность,
	|	абс_ЗначенияПоказателейДляРасчетаКПЭ.Сотрудник,
	|	абс_ЗначенияПоказателейДляРасчетаКПЭ.ЗначениеПоказателя
	|ПОМЕСТИТЬ ВТ_ЗначенияФакта
	|ИЗ
	|	РегистрСведений.абс_ЗначенияПоказателейДляРасчетаКПЭ КАК абс_ЗначенияПоказателейДляРасчетаКПЭ
	|ГДЕ
	|	абс_ЗначенияПоказателейДляРасчетаКПЭ.ВидОперации В (ЗНАЧЕНИЕ(Перечисление.абс_ВидыОперацийВводаЗначенийПоказателейДляРасчетаКПЭ.ФактическиеЗначения), ЗНАЧЕНИЕ(Перечисление.абс_ВидыОперацийВводаЗначенийПоказателейДляРасчетаКПЭ.КорректировкаФактическихЗначений))
	|	И абс_ЗначенияПоказателейДляРасчетаКПЭ.ВидПремии = &ВидПремии
	|	И абс_ЗначенияПоказателейДляРасчетаКПЭ.Показатель = &Показатель
	|	И абс_ЗначенияПоказателейДляРасчетаКПЭ.Организация = &Организация
	|	И НАЧАЛОПЕРИОДА(абс_ЗначенияПоказателейДляРасчетаКПЭ.Период, ГОД) = НАЧАЛОПЕРИОДА(&Период, ГОД)
	|
	|СГРУППИРОВАТЬ ПО
	|	абс_ЗначенияПоказателейДляРасчетаКПЭ.Показатель,
	|	абс_ЗначенияПоказателейДляРасчетаКПЭ.НомерКорректировки,
	|	абс_ЗначенияПоказателейДляРасчетаКПЭ.ВидАналитикиКПЭ,
	|	абс_ЗначенияПоказателейДляРасчетаКПЭ.Подразделение,
	|	абс_ЗначенияПоказателейДляРасчетаКПЭ.Должность,
	|	абс_ЗначенияПоказателейДляРасчетаКПЭ.Сотрудник,
	|	абс_ЗначенияПоказателейДляРасчетаКПЭ.ЗначениеПоказателя
	|;
	|
	|////////////////////////////////////////////////////////////////////////////////
	|ВЫБРАТЬ
	|	ТаблицаКорректировокФакта.Показатель,
	|	ТаблицаКорректировокФакта.ВидАналитикиКПЭ,
	|	ТаблицаКорректировокФакта.Подразделение,
	|	ТаблицаКорректировокФакта.Должность,
	|	ТаблицаКорректировокФакта.Сотрудник,
	|	ВТ_ЗначенияФакта.ЗначениеПоказателя КАК ЗначениеПоказателя
	|ПОМЕСТИТЬ ВТ_ЗначенияФактаСКорректировками
	|ИЗ
	|	(ВЫБРАТЬ
	|		ВТ_ЗначенияФакта.Показатель КАК Показатель,
	|		МАКСИМУМ(ВТ_ЗначенияФакта.НомерКорректировки) КАК НомерКорректировки,
	|		ВТ_ЗначенияФакта.ВидАналитикиКПЭ КАК ВидАналитикиКПЭ,
	|		ВТ_ЗначенияФакта.Подразделение КАК Подразделение,
	|		ВТ_ЗначенияФакта.Должность КАК Должность,
	|		ВТ_ЗначенияФакта.Сотрудник КАК Сотрудник
	|	ИЗ
	|		ВТ_ЗначенияФакта КАК ВТ_ЗначенияФакта
	|	
	|	СГРУППИРОВАТЬ ПО
	|		ВТ_ЗначенияФакта.Должность,
	|		ВТ_ЗначенияФакта.Сотрудник,
	|		ВТ_ЗначенияФакта.Подразделение,
	|		ВТ_ЗначенияФакта.ВидАналитикиКПЭ,
	|		ВТ_ЗначенияФакта.Показатель) КАК ТаблицаКорректировокФакта
	|		ЛЕВОЕ СОЕДИНЕНИЕ ВТ_ЗначенияФакта КАК ВТ_ЗначенияФакта
	|		ПО ТаблицаКорректировокФакта.Показатель = ВТ_ЗначенияФакта.Показатель
	|			И ТаблицаКорректировокФакта.НомерКорректировки = ВТ_ЗначенияФакта.НомерКорректировки
	|			И ТаблицаКорректировокФакта.ВидАналитикиКПЭ = ВТ_ЗначенияФакта.ВидАналитикиКПЭ
	|			И ТаблицаКорректировокФакта.Подразделение = ВТ_ЗначенияФакта.Подразделение
	|			И ТаблицаКорректировокФакта.Должность = ВТ_ЗначенияФакта.Должность
	|			И ТаблицаКорректировокФакта.Сотрудник = ВТ_ЗначенияФакта.Сотрудник
	|;
	|
	|////////////////////////////////////////////////////////////////////////////////
	|ВЫБРАТЬ
	|	&Период КАК Период,
	|	ВТ_ЗначенияПланаСКорректировками.Показатель,
	|	ВТ_ЗначенияПланаСКорректировками.ВидАналитикиКПЭ,
	|	ВТ_ЗначенияПланаСКорректировками.Подразделение,
	|	ВТ_ЗначенияПланаСКорректировками.Должность,
	|	ВТ_ЗначенияПланаСКорректировками.Сотрудник,
	|	ЕСТЬNULL(ВТ_ЗначенияПланаСКорректировками.ЗначениеПоказателя, 0) КАК ЗначениеПоказателяПлан,
	|	ЕСТЬNULL(ВТ_ЗначенияФактаСКорректировками.ЗначениеПоказателя, 0) КАК ЗначениеПоказателяФакт
	|ИЗ
	|	ВТ_ЗначенияПланаСКорректировками КАК ВТ_ЗначенияПланаСКорректировками
	|		ПОЛНОЕ СОЕДИНЕНИЕ ВТ_ЗначенияФактаСКорректировками КАК ВТ_ЗначенияФактаСКорректировками
	|		ПО ВТ_ЗначенияПланаСКорректировками.Показатель = ВТ_ЗначенияФактаСКорректировками.Показатель
	|			И ВТ_ЗначенияПланаСКорректировками.ВидАналитикиКПЭ = ВТ_ЗначенияФактаСКорректировками.ВидАналитикиКПЭ
	|			И ВТ_ЗначенияПланаСКорректировками.Подразделение = ВТ_ЗначенияФактаСКорректировками.Подразделение
	|			И ВТ_ЗначенияПланаСКорректировками.Должность = ВТ_ЗначенияФактаСКорректировками.Должность
	|			И ВТ_ЗначенияПланаСКорректировками.Сотрудник = ВТ_ЗначенияФактаСКорректировками.Сотрудник");
	
	Запрос.УстановитьПараметр("Период"			, Ссылка.ПериодРегистрации);
	Запрос.УстановитьПараметр("Организация"		, Ссылка.Организация);
	Запрос.УстановитьПараметр("ВидПремии"		, Ссылка.ВидПремии);
	Запрос.УстановитьПараметр("Показатель"		, Ссылка.Показатель);
	
 	Возврат Запрос.Выполнить().Выгрузить();
		
КонецФункции
