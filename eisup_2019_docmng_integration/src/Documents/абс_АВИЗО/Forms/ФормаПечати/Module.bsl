&НаСервере
Процедура ПолучитьСписокДокументов()
	Запрос = Новый Запрос;
	Запрос.Текст = 
	"ВЫБРАТЬ
	|	абс_АВИЗО.Ссылка КАК Документ
	|ИЗ
	|	Документ.абс_АВИЗО КАК абс_АВИЗО
	|ГДЕ
	|	абс_АВИЗО.НомерДляПечати = &НомерДляПечати
	|	И абс_АВИЗО.РаспределениеДоходовРасходов <> ЗНАЧЕНИЕ(Документ.абс_РаспределяемыеДоходыРасходы.ПустаяСсылка)
	|	И абс_АВИЗО.ОрганизацияПриемник = &Филиал";
	
	Запрос.УстановитьПараметр("НомерДляПечати", НомерДляПечати);
	Запрос.УстановитьПараметр("Филиал", Филиал);
    ТзДокументы.Загрузить(Запрос.Выполнить().Выгрузить());
	   
КонецПроцедуры

&НаСервере
Функция ПолучитьТабличныйДокументСводнаяВедомостьПоАвизоСервер(ВидОперацииРаспределения)
	
	МассивДокументов = Новый Массив;
	Для каждого Стр Из ТзДокументы Цикл
		Если ВидОперацииРаспределения = 0 И Стр.Документ.РаспределениеДоходовРасходов.ВидОперацииРаспределния = 0 Тогда 
			НачальникОтделаСводнойОтчетности =  Стр.Документ.РаспределениеДоходовРасходов.НачальникОтделаСводнойОтчетности;
			МассивДокументов.Добавить(Стр.Документ.ДокументОснованиеПриемник);
		ИначеЕсли ВидОперацииРаспределения = 1 И Стр.Документ.РаспределениеДоходовРасходов.ВидОперацииРаспределния = 1  Тогда
			НачальникОтделаСводнойОтчетности =  Стр.Документ.РаспределениеДоходовРасходов.НачальникОтделаСводнойОтчетности;
			МассивДокументов.Добавить(Стр.Документ.ДокументОснованиеПриемник);
		КонецЕсли;
	КонецЦикла;
	
	Если МассивДокументов.Количество() > 0 Тогда
		
		Если ВидОперацииРаспределения = 0 Тогда 
			Возврат Документы.абс_РаспределяемыеДоходыРасходы.ВыполнитьПечатьАвизоОРаспределяемыхДоходах(МассивДокументов,Филиал,НачальникОтделаСводнойОтчетности,НомерДляПечати.НомерДляПечати);
		Иначе
			Возврат Документы.абс_РаспределяемыеДоходыРасходы.ВыполнитьПечатьАвизоОРаспределяемыхРасходах(МассивДокументов,Филиал,НачальникОтделаСводнойОтчетности,НомерДляПечати.НомерДляПечати);
		КонецЕсли;	
	КонецЕсли;	
	
КонецФункции

&НаКлиенте
Процедура Печать(Команда)

	ТабДок = ПолучитьТабличныйДокументСводнаяВедомостьПоАвизоСервер(0);
	УниверсальныеМеханизмы.НапечататьДокумент(ТабДок, 1, Ложь,"Авизо о распределяемых доходах");
	
	ТабДок = ПолучитьТабличныйДокументСводнаяВедомостьПоАвизоСервер(1);
	УниверсальныеМеханизмы.НапечататьДокумент(ТабДок, 1, Ложь,"Авизо о распределяемых расходах");
	
КонецПроцедуры

&НаКлиенте
Процедура ОбновитьТз(Команда)
	
	ПолучитьСписокДокументов();
	
КонецПроцедуры

&НаКлиенте
Процедура ОбработкаОповещения(ИмяСобытия, Параметр, Источник)
	Если ИмяСобытия = "ПодборФилиалаРаспределяемыеДоходыРасходы" Тогда	
		Филиал =  Параметр;
	КонецЕсли;	
КонецПроцедуры
