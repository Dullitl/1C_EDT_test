
Функция ОтветственныеЛицаОрганизаций(Организация, ДатаСреза)
	
	Результат = Новый Структура("Руководитель, РуководительДолжность, ГлавныйБухгалтер");//, Кассир, Исполнитель, ИсполнительДолжность, ОтветственныйЗаРегистры");
	
	ЗапросПоЛицам = Новый Запрос();
	ЗапросПоЛицам.УстановитьПараметр("Организация", Организация);
	ЗапросПоЛицам.УстановитьПараметр("ДатаСреза",   ДатаСреза);
	
	ЗапросПоЛицам.Текст = "ВЫБРАТЬ РАЗРЕШЕННЫЕ
	                      |	ОтветственныеЛицаОрганизацийСрезПоследних.ОтветственноеЛицо,
	                      |	ОтветственныеЛицаОрганизацийСрезПоследних.Должность.Наименование КАК Должность,
	                      |	ОтветственныеЛицаОрганизацийСрезПоследних.ФизическоеЛицо
	                      |ИЗ
	                      |	РегистрСведений.ОтветственныеЛицаОрганизаций.СрезПоследних(&ДатаСреза, СтруктурнаяЕдиница = &Организация) КАК ОтветственныеЛицаОрганизацийСрезПоследних";
	
	Выборка = ЗапросПоЛицам.Выполнить().Выбрать();
	
	Пока Выборка.Следующий() Цикл
		
		Если Выборка.ОтветственноеЛицо = Перечисления.ОтветственныеЛицаОрганизаций.Руководитель Тогда
			Результат.Руководитель            = Выборка.ФизическоеЛицо;
			Результат.РуководительДолжность   = Выборка.Должность;
			
		ИначеЕсли Выборка.ОтветственноеЛицо = Перечисления.ОтветственныеЛицаОрганизаций.ГлавныйБухгалтер Тогда
			Результат.ГлавныйБухгалтер        = Выборка.ФизическоеЛицо;			
		КонецЕсли;

	КонецЦикла; 
	
	Возврат Результат;
		
КонецФункции

Процедура ПередЗаписью(Отказ)
	
	Если ОбменДанными.Загрузка = Истина Тогда
		Возврат;
	КонецЕсли;
	
	//АБС ВСТАВКА №000020910 НАЧАЛО
	//Руководители = ОтветственныеЛицаОрганизаций(Организация, абс_СерверныеФункции.ПолучитьДатуСервера());
	//Руководитель = Руководители.Руководитель;
	//Бухгалтер    = Руководители.ГлавныйБухгалтер;	
	//Если Сотрудник.Физлицо <> Руководитель Или Сотрудник.Физлицо <> Бухгалтер
	//	//И Не ЗначениеЗаполнено(Доверенность)   //Задача 000019635 
	//	Тогда                                		
	//	ttk_ОбщегоНазначения.СообщитьОбОшибке("Сотрудник не является ни руководителем, ни главным бухгалтером.", Отказ);		
	//КонецЕсли;
	//\\АБС ВСТАВКА №000020910 КОНЕЦ
	
	Если ЗначениеЗаполнено(ПоУмолчанию) И ПоУмолчанию <> "-" Тогда
		
		Запрос = Новый Запрос;
		Запрос.Текст = "ВЫБРАТЬ РАЗРЕШЕННЫЕ
		               |	абс_Подписанты.Ссылка
		               |ИЗ
		               |	Справочник.абс_Подписанты КАК абс_Подписанты
		               |ГДЕ
		               |	абс_Подписанты.Организация = &Организация
		               |	И абс_Подписанты.ВидПодписанта = &ВидПодписанта
		               |	И абс_Подписанты.НеИспользовать = ЛОЖЬ
		               |	И абс_Подписанты.ПоУмолчанию = &ПоУмолчанию
		               |	И абс_Подписанты.Ссылка <> &Ссылка";
					   
		Запрос.УстановитьПараметр("Организация", Организация);
		Запрос.УстановитьПараметр("ВидПодписанта", ВидПодписанта);
		Запрос.УстановитьПараметр("ПоУмолчанию",   ПоУмолчанию);
		Запрос.УстановитьПараметр("Ссылка",        Ссылка);
		
		РезультатЗапроса = Запрос.Выполнить().Выбрать();
		
		Если РезультатЗапроса.Следующий() Тогда 			
			ttk_ОбщегоНазначения.СообщитьОбОшибке("Для указнного вида подписанта и документа по умолчанию выбран " + Строка(РезультатЗапроса.Ссылка), Отказ);  			
		КонецЕсли;
		
	КонецЕсли;
	
КонецПроцедуры
