
&НаКлиенте
Процедура ДобавитьАртикул(Команда)
	
	НовыйАртикул = "";
	
	Если НЕ ВвестиСтроку(НовыйАртикул, "Введите новый артикул.", 100, Ложь) Тогда
		Возврат;
	КонецЕсли;
	
	СоздатьХарактеристику(НовыйАртикул); 
	
	Элементы.Список.Обновить();
	
КонецПроцедуры

&НаСервере 
Процедура СоздатьХарактеристику(СтрокаАртикул, Отказ = Ложь)
	
	ТекНоменклатура = Неопределено;
	
	Для Каждого ЭлементОтбора Из Список.Отбор.Элементы Цикл
		
		Если ЭлементОтбора.ЛевоеЗначение = Новый ПолеКомпоновкиДанных("Владелец") И ЭлементОтбора.Использование Тогда
			
			ТекНоменклатура = ЭлементОтбора.ПравоеЗначение;
			
		КонецЕсли;
		
	КонецЦикла;
	
	Если ТекНоменклатура.Пустая() Тогда
		ttk_ОбщегоНазначения.СообщитьОбОшибке("Не выбрана номенклатура.", Отказ);
		
	ИначеЕсли НЕ ТекНоменклатура.ВестиУчетПоХарактеристикам Тогда
		ttk_ОбщегоНазначения.СообщитьОбОшибке("По номенклатуре не ведется учет по характеристикам.", Отказ);
		
	КонецЕсли;
	
	Если Отказ Тогда
		Возврат;
	КонецЕсли;
	
	СвойствоАртикул = ПланыВидовХарактеристик.СвойстваОбъектов.НайтиПоНаименованию("Артикул");
	
	НайденнаяХарактеристика = Справочники.ХарактеристикиНоменклатуры.НайтиПоНаименованию(СтрокаАртикул, Истина, , ТекНоменклатура);
	
	Если НЕ НайденнаяХарактеристика.Пустая() Тогда
		ttk_ОбщегоНазначения.СообщитьОбОшибке("Такой артикул уже есть в базе.", Отказ);
	КонецЕсли;
	
	Если Отказ Тогда
		Возврат;
	КонецЕсли;
	
	// Добавляем характеристику
	НоваяХарактеристика = Справочники.ХарактеристикиНоменклатуры.СоздатьЭлемент();
	
	НоваяХарактеристика.Владелец 		= ТекНоменклатура;	
	НоваяХарактеристика.Наименование 	= СтрокаАртикул;
	НоваяХарактеристика.Активная		= Истина;
	
	НоваяХарактеристика.Записать();
	
	НаборЗначенияСвойств = РегистрыСведений.ЗначенияСвойствОбъектов.СоздатьНаборЗаписей();
	
	НаборЗначенияСвойств.Отбор.Объект.Установить(ТекНоменклатура);
	НаборЗначенияСвойств.Отбор.Свойство.Установить(СвойствоАртикул);
	
	ЗаписьЗначениеСвойства = НаборЗначенияСвойств.Добавить();
	ЗаписьЗначениеСвойства.Объект 	= ТекНоменклатура;
	ЗаписьЗначениеСвойства.Свойство = СвойствоАртикул;
	
	ЗначениеСвойства = Справочники.ЗначенияСвойствОбъектов.НайтиПоНаименованию(СтрокаАртикул, Истина, ,СвойствоАртикул);
	
	Если ЗначениеСвойства.Пустая() Тогда
		НовоеЗначениеСвойтсва = Справочники.ЗначенияСвойствОбъектов.СоздатьЭлемент();
		НовоеЗначениеСвойтсва.Наименование 	= СтрокаАртикул;
		НовоеЗначениеСвойтсва.Владелец		= СвойствоАртикул;
		НовоеЗначениеСвойтсва.Записать();
	КонецЕсли;
	
	ЗаписьЗначениеСвойства.Значение = НовоеЗначениеСвойтсва.Ссылка;
	
КонецПроцедуры


&НаКлиенте
Процедура ОбновитьСписок(Команда)
	
	Элементы.Список.Обновить();
	
КонецПроцедуры

