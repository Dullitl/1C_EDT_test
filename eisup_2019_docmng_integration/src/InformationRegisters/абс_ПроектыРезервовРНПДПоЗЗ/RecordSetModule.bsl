
Процедура ПередЗаписью(Отказ, Замещение)
	
	ТекПользователь 	= глЗначениеПеременной("глТекущийПользователь");
	РолиПользователя 	= Новый Массив;
	ТекЗЗ 				= Документы.абс_ЗакупочныйЗаказ.ПустаяСсылка();
	
	ДатаЗапретаРНПД	    = Константы.абс_ГраницаЗапретаРНПД.Получить();
	
	Если ЭтотОбъект.Количество() > 0 Тогда
		
		ТекЗапись = ЭтотОбъект[0];
		
		ЦФООтветственного 	= абс_БизнесПроцессы.ПолучитьОтветственныхРНПДПоЦФО(ТекПользователь, ТекЗапись.Организация, Перечисления.абс_ВидыДокументовРНПД.ПоДирекции);		
		РолиПользователя 	= абс_БизнесПроцессы.ПолучитьСписокДоступныхРолейПользователя(ТекПользователь, ТекЗапись.Организация);
		ТекЗЗ 				= ТекЗапись.ЗакупочныйЗаказ;
		
	КонецЕсли;	
	
	СписокПериодов = ЭтотОбъект.ВыгрузитьКолонку("Период");
	
	ТабСтатусовРНПД = абс_БизнесПроцессы.ПолучитьСтатусРНПДИзЗЗ(ТекЗЗ, СписокПериодов);
	
	НарушенаГраницаЗапретаРНПД = Ложь;
	
	Для Каждого ТекЗапись Из ЭтотОбъект Цикл
		
		Если ТекЗапись.Период < ДатаЗапретаРНПД И ЗначениеЗаполнено(ДатаЗапретаРНПД) Тогда
			
			НарушенаГраницаЗапретаРНПД = Истина;
			
		КонецЕсли;
		
		Если НЕ ЗначениеЗаполнено(ТекЗапись.Ответственный) Тогда
			
			ТекЗапись.Ответственный = ТекПользователь;
			
		КонецЕсли;
		 //ххх Брель Виктор Андреевич 31.05.2018 19:04:17, заявка <<<
		Если НЕ ЗначениеЗаполнено(ТекЗапись.ttk_ПериодВозникновенияЗадолженности) Тогда
			Отказ = Истина;
			ttk_ОбщегоНазначения.СообщитьОбОшибке("Не заполнен период возникновения задолженности ", Отказ);		
		КонецЕсли;

		 // Брель Виктор Андреевич 31.05.2018 19:04:17 >>>
		 
		Если НЕ ЗначениеЗаполнено(ТекЗапись.Организация) И ЗначениеЗаполнено(ТекЗапись.ЗакупочныйЗаказ) Тогда
			
			ТекЗапись.Организация = ТекЗапись.ЗакупочныйЗаказ.Организация;
			
		КонецЕсли;
		
		Если (ЦФООтветственного.Найти(ТекЗапись.ЗакупочныйЗаказ.ЦФО) = Неопределено) И (РолиПользователя.Найти(Справочники.РолиИсполнителей.СуперПользовательРНПД) = Неопределено) Тогда
			
			ttk_ОбщегоНазначения.СообщитьОбОшибке("Не достаточно прав для ввода данных по ЦФО ", Отказ);
			
		КонецЕсли;
				
	КонецЦикла;
	
	Если НарушенаГраницаЗапретаРНПД Тогда
		
		ttk_ОбщегоНазначения.СообщитьОбОшибке("Нарушена граница запрета ввода РНПД.", Отказ);
		
	КонецЕсли;
	
КонецПроцедуры
